<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Tra c·ª©u Th√¥ng tin N√¢ng c·∫•p</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      /* --- [N√ÇNG C·∫§P] B·∫£ng m√†u "B·∫°ch Kim" - S√°ng, Sang tr·ªçng --- */
      :root {
        --text-color: #1F2937; /* X√°m than */
        --label-color: #6B7280; /* X√°m trung b√¨nh */
        --input-border: #D1D5DB; /* Vi·ªÅn x√°m nh·∫°t */
        --input-focus-border: #D97706; /* V√†ng h·ªï ph√°ch ƒë·∫≠m */
        --button-bg: #F59E0B; /* V√†ng h·ªï ph√°ch */
        --button-hover-bg: #D97706; /* V√†ng ƒë·∫≠m h∆°n */
        --button-text-color: #FFFFFF;
        --box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --note-bg: #F3F4F6; /* N·ªÅn ghi ch√∫ x√°m r·∫•t nh·∫°t */
        --input-icon-color: #9CA3AF;
        --input-bg: #F9FAFB;
        --form-bg: #FFFFFF;
        --warning-color: #EF4444;
        --success-color: #10B981;
        --info-color: #3B82F6;
        --button-disabled-bg: #E5E7EB;
        --background-color: #F1F2F6; /* N·ªÅn x√°m ·∫•m */
      }
      
      body {
        font-family: 'Inter', 'Roboto', sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        box-sizing: border-box;
      }

      .search-container {
        max-width: 550px;
        width: 100%;
        margin: 40px auto;
        background: var(--form-bg);
        border: 1px solid #E5E7EB;
        padding: 40px;
        border-radius: 24px;
        box-shadow: var(--box-shadow);
      }
      
      h2 { 
        text-align: center; 
        margin: 0 0 8px 0; 
        font-size: 2.25em; 
        font-weight: 700; 
        letter-spacing: -0.5px;
        color: #D97706; 
      }
      
      p.subtitle { 
        text-align: center; 
        font-size: 1em; 
        color: var(--label-color); 
        margin: 0 0 30px 0; 
      }
      
      .input-wrapper { 
        position: relative; 
        display: flex; 
        align-items: center; 
      }
      
      .input-wrapper svg { 
        position: absolute; 
        left: 14px; 
        width: 20px; 
        height: 20px; 
        stroke: var(--input-icon-color); 
        pointer-events: none; 
      }
      
      input {
        width: 100%; 
        padding: 12px 12px 12px 45px; 
        border: 1px solid var(--input-border); 
        border-radius: 10px; 
        box-sizing: border-box; 
        background-color: var(--input-bg); 
        color: var(--text-color); 
        font-size: 1em; 
        transition: all 0.2s ease-in-out;
      }
      
      input:focus { 
        border-color: var(--input-focus-border); 
        background-color: #FFFFFF;
        box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2); 
        outline: none; 
      }
      
      button { 
        margin-top: 20px; 
        padding: 14px 20px; 
        background: var(--button-bg); 
        color: var(--button-text-color); 
        border: none; 
        border-radius: 10px; 
        cursor: pointer; 
        font-weight: 700; 
        font-size: 1.1em; 
        width: 100%; 
        transition: all 0.2s ease-in-out; 
        box-shadow: 0 1px 2px rgba(0,0,0,0.05), 0 4px 12px rgba(245, 158, 11, 0.2);
      }
      
      button:hover:not(:disabled) { 
        background-color: var(--button-hover-bg); 
        transform: translateY(-2px); 
        box-shadow: 0 1px 2px rgba(0,0,0,0.05), 0 6px 20px rgba(217, 119, 6, 0.3);
      }
      
      button:disabled { 
        background-color: var(--button-disabled-bg); 
        cursor: not-allowed; 
        box-shadow: none; 
        color: #9CA3AF;
      }

      /* CSS cho V√πng K·∫øt qu·∫£ */
      #resultArea { 
          margin-top: 30px; 
          padding: 25px; 
          border-radius: 12px; 
          background-color: var(--note-bg); 
          text-align: center; 
          display: none; 
          border: 1px solid var(--input-border);
          line-height: 1.6;
      }
      
      .result-title { 
        font-weight: 700; 
        font-size: 1.25em; 
        margin-bottom: 12px; 
      }
      
      .result-detail { 
        margin: 10px 0; 
        font-size: 1em; 
        color: var(--label-color); 
      }
      .result-detail strong {
        color: var(--text-color);
      }

      .highlight { 
        color: var(--button-hover-bg); 
        font-weight: 700; 
      }

      /* N√∫t N√¢ng c·∫•p */
      .upgrade-button { 
          margin-top: 20px; 
          display: inline-block; 
          padding: 12px 24px; 
          background: var(--button-bg); 
          color: var(--button-text-color) !important; 
          border-radius: 8px; 
          text-decoration: none; 
          font-weight: 500; 
          font-size: 1em; 
          transition: all 0.2s ease-in-out; 
          box-shadow: 0 4px 14px 0 rgba(251, 191, 36, 0.3);
      }
      
      .upgrade-button:hover { 
          background-color: var(--button-hover-bg); 
          transform: translateY(-2px);
          box-shadow: 0 6px 20px 0 rgba(251, 191, 36, 0.2);
      }
      
      /* Loader */
      .loader { 
        border: 4px solid #E5E7EB; 
        border-top: 4px solid var(--button-bg); 
        border-radius: 50%; 
        width: 24px; height: 24px; 
        animation: spin 1s linear infinite; 
        margin: 20px auto; 
        display: none; 
      }
      
      @keyframes spin { 
        0% { transform: rotate(0deg); } 
        100% { transform: rotate(360deg); } 
      }

      /* Media Query cho thi·∫øt b·ªã di ƒë·ªông */
      @media (max-width: 480px) {
        body { padding: 10px; }
        .search-container { padding: 30px 25px; }
        h2 { font-size: 1.8em; }
        .result-title { font-size: 1.15em; }
        .upgrade-button { padding: 12px 20px; font-size: 1em; }
      }
    </style>
</head>
<body>
    <div class="search-container">
        <h2>Tra c·ª©u & N√¢ng c·∫•p L·ªô tr√¨nh</h2>
        <p class="subtitle">Nh·∫≠p S·ªë ƒëi·ªán tho·∫°i ho·∫∑c Email b·∫°n ƒë√£ ƒëƒÉng k√Ω ƒë·ªÉ t√¨m th√¥ng tin</p>
        <div style="font-size: 0.9em; margin-bottom: 20px; text-align: center;">
  <p style="margin: 5px 0;">‚ú® B·∫°n l√† h·ªçc vi√™n m·ªõi? Li√™n h·ªá ng∆∞·ªùi gi·ªõi thi·ªáu ho·∫∑c BTC: <a href="tel:0917138286" class="result-box-button" target="_self">0917138286</a> ƒë·ªÉ l·∫•y link ƒëƒÉng k√Ω.</p>
  <p style="margin: 5px 0;">üìö B·∫°n mu·ªën h·ªçc th√™m c√°c l·ªõp ng·∫Øn ng√†y kh√°c? <a href="https://www.giautoandien.site/chuyenlop" target="_blank">Truy c·∫≠p trang ƒëƒÉng k√Ω l·ªõp m·ªõi</a>.</p>
</div>
        <div class="input-wrapper">
            <input type="text" id="searchInput" placeholder="Nh·∫≠p SƒêT Zalo ho·∫∑c Email..." required>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg>
        </div>
        <button id="searchButton">T√¨m th√¥ng tin c·ªßa t√¥i</button>
        <div class="loader" id="loader"></div>
        <div id="resultArea"></div>
    </div>

    <script>
        // B·ªè qua vi·ªác l·∫•y Apps Script URL ·ªü ƒë√¢y v√¨ link ƒë√£ ƒë∆∞·ª£c t·∫°o s·∫µn trong Code.gs

        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const resultArea = document.getElementById('resultArea');
        const loader = document.getElementById('loader');

        searchButton.addEventListener('click', handleSearch);
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                handleSearch();
            }
        });

        function handleSearch() {
            const contactInfo = searchInput.value.trim();
            if (!contactInfo) return;

            // 1. Chu·∫©n b·ªã giao di·ªán ch·ªù
            resultArea.style.display = 'none';
            loader.style.display = 'block';
            searchButton.disabled = true;
            searchButton.textContent = 'ƒêang t√¨m ki·∫øm...';

            // 2. G·ªçi h√†m Apps Script
            google.script.run
                .withSuccessHandler(displayResult)
                .withFailureHandler(displayError)
                .findStudentInfoByPhoneOrEmail(contactInfo); 
        }
// THAY TH·∫æ H√ÄM N√ÄY (ƒê·ªÉ ƒë·∫£m b·∫£o g·ªçi fixZaloLink ·ªü cu·ªëi)
function displayResult(userInfo) {
    // 3. Kh√¥i ph·ª•c tr·∫°ng th√°i n√∫t/loader
    loader.style.display = 'none';
    searchButton.disabled = false;
    searchButton.textContent = 'T√¨m th√¥ng tin c·ªßa t√¥i';
    resultArea.style.display = 'block';

    let html = '';
    let borderColor = '';

    if (userInfo.status === 'ELIGIBLE') {
        // Tr∆∞·ªùng h·ª£p 1: ƒê·ªß ƒëi·ªÅu ki·ªán n√¢ng c·∫•p
        const upgradeLink = userInfo.upgradeUrl; 
        borderColor = 'var(--button-bg)';
        html = `<div class="result-title" style="color: var(--button-bg);">Ch√†o m·ª´ng tr·ªü l·∫°i, ${userInfo.name}!</div>
                <div class="result-detail">M√£ s·ªë c·ªßa b·∫°n l√†: <span class="highlight">${userInfo.code}</span></div>
                <div class="result-detail">H·ªá th·ªëng ghi nh·∫≠n b·∫°n **ƒë·ªß ƒëi·ªÅu ki·ªán** n√¢ng c·∫•p l√™n L·ªô tr√¨nh 86 ng√†y.</div>
                <a id="upgradeButton" href="${upgradeLink}" class="upgrade-button" target="_blank">N√¢ng c·∫•p ngay b√¢y gi·ªù</a>`;
                
    } else if (userInfo.status === 'ALREADY_UPGRADED') {
        // Tr∆∞·ªùng h·ª£p 2: ƒê√£ n√¢ng c·∫•p r·ªìi
        borderColor = 'var(--info-color)';
        html = `<div class="result-title" style="color: var(--info-color);">B·∫°n ƒë√£ l√† th√†nh vi√™n VIP!</div>
                <div class="result-detail">Ch√†o <strong>${userInfo.name}</strong>, h·ªá th·ªëng ghi nh·∫≠n b·∫°n ƒë√£ l√† th√†nh vi√™n c·ªßa L·ªô tr√¨nh **86 ng√†y ƒë·ªìng h√†nh**. C·∫£m ∆°n b·∫°n ƒë√£ ƒë·ªìng h√†nh!</div>`;
                
    } else if (userInfo.status === 'NOT_FOUND') {
        // Tr∆∞·ªùng h·ª£p 3: Kh√¥ng t√¨m th·∫•y
        borderColor = 'var(--warning-color)';
        html = `<div class="result-title" style="color: var(--warning-color);">Kh√¥ng t√¨m th·∫•y th√¥ng tin</div>
                <div class="result-detail">Kh√¥ng t√¨m th·∫•y th√¥ng tin ƒëƒÉng k√Ω v·ªõi SƒêT/Email n√†y. Vui l√≤ng ki·ªÉm tra l·∫°i ho·∫∑c li√™n h·ªá ng∆∞·ªùi gi·ªõi thi·ªáu ho·∫∑c Ban t·ªï ch·ª©c</div>`;
                
    } else { // status === 'ERROR'
        // Tr∆∞·ªùng h·ª£p 4: L·ªói h·ªá th·ªëng
        borderColor = 'var(--warning-color)';
        html = `<div class="result-title" style="color: var(--warning-color);">L·ªói H·ªá Th·ªëng</div>
                <div class="result-detail">ƒê√£ c√≥ l·ªói x·∫£y ra: ${userInfo.message || 'Kh√¥ng x√°c ƒë·ªãnh'}. Vui l√≤ng th·ª≠ l·∫°i sau.</div>`;
    }

    resultArea.style.border = `1px solid ${borderColor}`;
    resultArea.innerHTML = html; // <<< N√∫t n√¢ng c·∫•p ƒë∆∞·ª£c hi·ªÉn th·ªã

    // --- G·ªåI H√ÄM S·ª¨A L·ªñI T·∫†I ƒê√ÇY ---
    // Ch·ªâ g·ªçi h√†m s·ª≠a l·ªói Zalo/th√™m click_feedback n·∫øu tr∆∞·ªùng h·ª£p l√† 'ELIGIBLE'
    if (userInfo.status === 'ELIGIBLE') {
      fixZaloLink(); 
    }
}
// THAY TH·∫æ H√ÄM N√ÄY
function fixZaloLink() {
    try {
        const upgradeBtn = document.getElementById('upgradeButton');
        if (!upgradeBtn) return; // Kh√¥ng t√¨m th·∫•y n√∫t th√¨ th√¥i

        // 1. S·ª≠a l·ªói Zalo (Gi·ªØ nguy√™n)
        const isZalo = navigator.userAgent.includes("Zalo");
        if (isZalo) {
            console.log("Ph√°t hi·ªán tr√¨nh duy·ªát Zalo. ƒêang s·ª≠a target link...");
            upgradeBtn.target = '_self'; 

            // (Code th√™m c·∫£nh b√°o Zalo c·ªßa b·∫°n - gi·ªØ nguy√™n)
            let warning = document.getElementById('zalo-warning');
            if (!warning) {
                warning = document.createElement('p');
                warning.id = 'zalo-warning';
                warning.style.color = '#D97706';
                warning.style.fontSize = '0.9em';
                warning.style.textAlign = 'center';
                warning.textContent = 'Tr√¨nh duy·ªát Zalo kh√¥ng h·ªó tr·ª£ m·ªü tab m·ªõi. Link s·∫Ω m·ªü t·∫°i c·ª≠a s·ªï n√†y.';
                upgradeBtn.parentNode.insertBefore(warning, upgradeBtn.nextSibling);
            }
        }
        
        // --- B·∫ÆT ƒê·∫¶U S·ª¨A L·ªñI (TH√äM PH·∫¢N H·ªíI KHI CLICK) ---
        // 2. Th√™m ph·∫£n h·ªìi khi nh·∫•n n√∫t
        upgradeBtn.addEventListener('click', function() {
            // Thay ƒë·ªïi n√∫t ngay l·∫≠p t·ª©c ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt l√† ƒëang t·∫£i
            upgradeBtn.textContent = 'ƒêang m·ªü, vui l√≤ng ch·ªù...';
            // D√πng c√°c bi·∫øn CSS c√≥ s·∫µn c·ªßa b·∫°n ƒë·ªÉ l√†m n√≥ tr√¥ng nh∆∞ b·ªã v√¥ hi·ªáu h√≥a
            upgradeBtn.style.backgroundColor = 'var(--button-disabled-bg)';
            upgradeBtn.style.color = '#9CA3AF';
            upgradeBtn.style.boxShadow = 'none';
            upgradeBtn.style.cursor = 'wait'; // ƒê·ªïi con tr·ªè chu·ªôt th√†nh "ch·ªù"
            
            // Kh√¥ng c·∫ßn preventDefault, ƒë·ªÉ link t·ª± ƒëi·ªÅu h∆∞·ªõng ƒëi
        });
        // --- K·∫æT TH√öC S·ª¨A L·ªñI ---

    } catch (e) {
        console.error("L·ªói khi s·ª≠a link Zalo: ", e);
    }
}

        function displayError(error) {
            // 4. X·ª≠ l√Ω l·ªói Apps Script
            loader.style.display = 'none';
            searchButton.disabled = false;
            searchButton.textContent = 'T√¨m th√¥ng tin c·ªßa t√¥i';
            resultArea.style.display = 'block';
            resultArea.style.border = '1px solid var(--warning-color)';
            resultArea.innerHTML = `<div class="result-title" style="color: var(--warning-color);">L·ªói K·∫øt N·ªëi</div><p class="result-detail">${error.message}. Vui l√≤ng th·ª≠ l·∫°i.</p>`;
        }
    </script>
</body>
</html>