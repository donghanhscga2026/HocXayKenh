<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·ªïng Th√¥ng Tin H·ªçc Vi√™n</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      /* --- B·∫¢NG M√ÄU & STYLE CHU·∫®N --- */
      :root { --text-color: #1F2937; --label-color: #6B7280; --input-border: #D1D5DB; --input-focus-border: #D97706; --button-bg: #F59E0B; --button-hover-bg: #D97706; --button-text-color: #FFFFFF; --box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.04); --note-bg: #F3F4F6; --input-icon-color: #9CA3AF; --input-bg: #F9FAFB; --form-bg: #FFFFFF; --selected-border: #F59E0B; --warning-color: #EF4444; --success-color: #10B981; --info-color: #3B82F6; --button-disabled-bg: #E5E7EB; --background-color: #F1F2F6; } 
      
      body { font-family: 'Inter', 'Roboto', sans-serif; background-color: #F1F2F6; color: var(--text-color); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; } 
      .form-container, .result-box { max-width: 550px; width: 100%; margin: 40px auto; background: var(--form-bg); border: 1px solid #E5E7EB; padding: 30px 40px; border-radius: 24px; box-shadow: var(--box-shadow); } 
      .form-header { text-align: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--input-border); } 
      .form-header h2 { margin: 0 0 8px 0; font-size: 2.25em; font-weight: 700; color: var(--text-color); } 
      .form-header .subtitle { font-size: 1em; color: var(--label-color); margin: 0; } 
      .form-group { margin-bottom: 24px; } 
      label { font-weight: 500; display: block; margin-bottom: 8px; color: var(--label-color); font-size: 0.9em; } 
      .input-wrapper { position: relative; display: flex; align-items: center; } 
      .input-wrapper svg { position: absolute; left: 14px; width: 20px; height: 20px; stroke: var(--input-icon-color); pointer-events: none; } 
      input[type="text"], input[type="tel"], input[type="email"], select, textarea { width: 100%; padding: 12px 12px 12px 45px; border: 1px solid var(--input-border); border-radius: 10px; box-sizing: border-box; background-color: var(--input-bg); font-size: 1em; } 
      select { padding-left: 12px; appearance: none; -webkit-appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="%239CA3AF" stroke-width="1.5"><path d="M7 7l3-3 3 3m0 6l-3 3-3-3" /></svg>'); background-repeat: no-repeat; background-position: right 14px center; background-size: 16px; } 
      input:read-only { background-color: #E5E7EB; cursor: not-allowed; } 
      button { padding: 14px 20px; background: var(--button-bg); color: var(--button-text-color); border: none; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 1.1em; width: 100%; } 
      button:disabled { background-color: var(--button-disabled-bg); cursor: not-allowed; color: #9CA3AF;}
    
     .warning-text { font-size: 0.88em; margin-top: 8px; display: none; color: var(--warning-color); } 
      .result-box { display: none; flex-direction: column; align-items: center; text-align: center; } 
      #loadingOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(4px); display: none; justify-content: center; align-items: center; z-index: 9999; } 
      .loader { border: 8px solid #E5E7EB; border-top: 8px solid var(--button-bg); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .result-box-button { display: inline-block; padding: 12px 25px; margin-top: 20px; background-color: #f59e0b; color: #FFFFFF !important; text-decoration: none !important; font-weight: 600; font-size: 1.1em; border-radius: 10px; transition: background-color 0.3s ease; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
      .result-box-button:hover { background-color: #d97706; }
      
      /* --- Style cho Tab --- */
      .tab-container { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--input-border); }
      .tab-button {
          padding: 12px 20px; border: none; background: transparent; cursor: pointer;
          font-size: 1em; font-weight: 500; color: var(--label-color);
          border-bottom: 3px solid transparent;
          transition: all 0.2s ease;
      }
      .tab-button.active { color: var(--button-bg); border-bottom-color: var(--button-bg); font-weight: 700; }
      .tab-content { display: none; }
      .tab-content.active { display: block; }
      
      /* --- Style cho c√°c Kh·ªëi Tr·∫°ng th√°i --- */
      .status-box { display: flex; flex-direction: column; align-items: center; text-align: center; padding: 30px; border-radius: 16px; margin-bottom: 20px; line-height: 1.6; }
      .status-icon { width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-bottom: 20px; }
      .status-icon svg { width: 32px; height: 32px; }
      .status-box.pending { background-color: #F9FAFB; }
      .status-box.pending .status-icon { background-color: #E5E7EB; }
      .status-box.pending .status-icon svg { stroke: #4B5563; }
      .status-box.upgraded { background-color: #F0FAF7; }
      .status-box.upgraded .status-icon { background-color: #DEF7EC; }
      .status-box.upgraded .status-icon svg { stroke: #057A55; }
      .status-box h3 { margin: 0 0 10px 0; font-size: 1.5em; }
      
      /* --- Style cho File Upload --- */
      .file-upload-wrapper { margin-top: 20px; }
      .file-upload-wrapper label { font-weight: 500; display: block; margin-bottom: 8px; color: var(--label-color); font-size: 0.9em; }
      input[type="file"] { width: 100%; font-size: 0.9em; border-radius: 8px; border: 1px solid var(--input-border); }
      input[type="file"]::file-selector-button { background: #F3F4F6; color: var(--text-color); border: none; border-right: 1px solid var(--input-border); padding: 10px 15px; margin-right: 15px; cursor: pointer; transition: background-color 0.2s; font-weight: 500; }
      input[type="file"]::file-selector-button:hover { background: #E5E7EB; }
      img.file-preview { display: none; width: 100%; max-width: 250px; height: auto; max-height: 250px; margin: 15px auto 0; border: 1px solid var(--input-border); border-radius: 8px; object-fit: contain; }
      
      /* --- Style cho Checkbox (N√¢ng c·∫•p) --- */
      .choice-group { display: flex; flex-direction: column; gap: 10px; }
      .choice-group label { display: flex; align-items: center; padding: 15px; border-radius: 10px; border: 1px solid var(--input-border); background-color: var(--input-bg); cursor: pointer; transition: all 0.2s ease; font-weight: 500; color: var(--text-color); font-size: 0.95em; }
      .choice-group label:hover { border-color: var(--button-hover-bg); background-color: #FEFCE8; }
      .choice-group input[type="checkbox"] { display: none; }
      .choice-group .icon { width: 20px; height: 20px; border: 2px solid var(--input-border); border-radius: 4px; margin-right: 12px; display: flex; justify-content: center; align-items: center; transition: all 0.2s ease; flex-shrink: 0; background-color: #FFFFFF; }
      .choice-group input[type="checkbox"]:checked + .icon { background-color: var(--selected-border); border-color: var(--selected-border); }
      .choice-group .icon svg { width: 14px; height: 14px; stroke: var(--button-text-color); stroke-width: 3; opacity: 0; transition: opacity 0.2s ease; }
      .choice-group input[type="checkbox"]:checked + .icon svg { opacity: 1; }
      .section-title { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 1.1em; color: var(--text-color); margin-top: 30px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--input-border); }
      .section-title svg { width: 22px; height: 22px; stroke: var(--button-bg); stroke-width: 1.5; }
      
      /* Style cho khung m√¥ t·∫£ kh√≥a h·ªçc */
      .course-description-box { background-color: #EFF6FF; border-left: 4px solid #3B82F6; padding: 15px; border-radius: 6px; margin-top: 15px; margin-bottom: 15px; font-size: 0.95em; color: #1E40AF; line-height: 1.5; display: none; animation: fadeIn 0.3s ease-in-out; }
      .course-description-box strong { display: block; margin-bottom: 5px; color: #1E3A8A; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
     /* --- CSS H·ªòP ƒê·∫∂C QUY·ªÄN VIP (GOLD STYLE) --- */
.benefit-box {
    /* N·ªÅn Gradient V√†ng Kem -> T·∫°o c·∫£m gi√°c cao c·∫•p */
    background: linear-gradient(135deg, #FFFCF5 0%, #FEF3C7 100%);
    
    /* Vi·ªÅn v√†ng kim lo·∫°i */
    border: 1px solid #F59E0B; 
    
    border-radius: 12px;
    padding: 25px 20px; /* TƒÉng padding m·ªôt ch√∫t cho tho√°ng */
    margin-bottom: 25px;
    
    /* ƒê·ªï b√≥ng n·ªïi nh·∫π */
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.15);
    position: relative;
    overflow: hidden;
}

/* Hi·ªáu ·ª©ng √°nh kim trang tr√≠ (Optional) */
.benefit-box::after {
    content: "";
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, transparent 60%);
    pointer-events: none;
}

.benefit-header {
    font-weight: 800; /* Ch·ªØ ƒë·∫≠m h∆°n */
    
    /* M√†u ch·ªØ V√†ng N√¢u ƒê·∫≠m */
    color: #92400E; 
    
    font-size: 1.15em;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-align: center; /* CƒÉn gi·ªØa ti√™u ƒë·ªÅ nh√¨n sang h∆°n */
    
    /* ƒê∆∞·ªùng g·∫°ch ch√¢n trang tr√≠ */
    border-bottom: 2px solid #FCD34D;
    padding-bottom: 10px;
    display: block; /* ƒê·∫£m b·∫£o chi·∫øm h·∫øt chi·ªÅu r·ªông */
}

.benefit-list {
    list-style: none;
    padding: 0;
    margin: 0;
    position: relative;
    z-index: 1; /* N·ªïi l√™n tr√™n l·ªõp n·ªÅn trang tr√≠ */
}

.benefit-list li {
    position: relative;
    padding-left: 32px; /* TƒÉng kho·∫£ng c√°ch l·ªÅ */
    margin-bottom: 10px;
    color: #4B5563; /* M√†u ch·ªØ x√°m ƒë·∫≠m d·ªÖ ƒë·ªçc */
    line-height: 1.6;
    font-size: 1em;
}
.benefit-list li:last-child { margin-bottom: 0; }

/* D·∫•u t√≠ch V (Checkmark) */
.benefit-list li .check {
    position: absolute;
    left: 0;
    top: 0px;
    
    /* M√†u Xanh L√° (ƒë·ªÉ nh·∫•n m·∫°nh s·ª± x√°c nh·∫≠n/ƒë∆∞·ª£c h∆∞·ªüng) */
    /* Ho·∫∑c b·∫°n c√≥ th·ªÉ ƒë·ªïi th√†nh m√†u Cam #D97706 n·∫øu mu·ªën ƒë·ªìng b·ªô ho√†n to√†n */
    color: #059669; 
    
    font-weight: 900;
    font-size: 1.3em;
    
    /* Th√™m b√≥ng nh·∫π cho d·∫•u t√≠ch */
    filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
}

/* T√¥ ƒë·∫≠m c√°c t·ª´ kh√≥a quan tr·ªçng trong list */
.benefit-list li strong {
    color: #B45309; /* M√†u n√¢u cam */
}
/* --- 1. H·ªòP M√î T·∫¢ KH√ìA H·ªåC (T√îNG XANH - TIN C·∫¨Y) --- */
.course-description-box {
    background-color: #F0F9FF; /* N·ªÅn xanh m√¢y tr·ªùi r·∫•t nh·∫°t */
    border-left: 5px solid #0EA5E9; /* Vi·ªÅn xanh d∆∞∆°ng t∆∞∆°i */
    border-radius: 8px;
    padding: 20px;
    margin-top: 15px;
    margin-bottom: 25px; /* C√°ch xa h·ªôp ti·ªÅn ra m·ªôt ch√∫t */
    font-size: 0.95em;
    color: #334155;
    line-height: 1.6;
    display: none;
    animation: fadeIn 0.4s ease-out;
}

.course-description-box .desc-title {
    display: flex; align-items: center;
    color: #0369A1; /* Ch·ªØ ti√™u ƒë·ªÅ xanh ƒë·∫≠m */
    font-weight: 700; font-size: 1.05em; margin-bottom: 8px;
}
.course-description-box .desc-title::before { content: "üí°"; margin-right: 8px; font-size: 1.2em; }

.course-description-box .desc-date {
    border-top: 1px dashed #BAE6FD; /* K·∫ª ngang xanh nh·∫°t */
    padding-top: 10px; margin-top: 10px;
    color: #0284C7; font-weight: 700; /* Ng√†y th√°ng m√†u xanh n·ªïi */
    display: flex; align-items: center;
}
.course-description-box .desc-date::before { content: "üìÖ"; margin-right: 8px; font-size: 1.1em; }


/* --- 2. H·ªòP TI·ªÄN C·ªåC (T√îNG V√ÄNG KEM - T√ÄI CH√çNH) --- */
.deposit-box {
    background-color: #FFFCF5; /* N·ªÅn kem s·ªØa ·∫•m √°p */
    border: 1px solid #FDE68A; /* Vi·ªÅn v√†ng nh·∫°t sang tr·ªçng */
    padding: 20px;
    border-radius: 12px;
    margin-top: 20px;
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.03); /* B√≥ng ƒë·ªï m√†u cam nh·∫π */
}

.deposit-box .section-title {
    /* Ti√™u ƒë·ªÅ c·ªßa h·ªôp ti·ªÅn */
    color: #B45309; /* M√†u n√¢u cam ƒë·∫≠m */
    border-bottom: 1px dashed #FCD34D;
}

.deposit-box ul { padding-left: 0; margin: 10px 0; list-style-type: none; }

.deposit-box li {
    margin-bottom: 8px; display: flex; align-items: flex-start;
    line-height: 1.4; font-size: 0.95em; color: #44403C; /* Ch·ªØ x√°m n√¢u */
}

.deposit-box li::before {
    content: "‚Ä¢"; color: #F59E0B; font-weight: bold;
    display: inline-block; width: 12px; flex-shrink: 0; font-size: 1.4em; line-height: 1; position: relative; top: 1px;
}

.deposit-box li strong { margin-right: 5px; white-space: nowrap; color: #1F2937; }
/* ƒêi·ªÅu ch·ªânh ri√™ng cho m√†n h√¨nh ƒëi·ªán tho·∫°i nh·ªè */
/* --- ƒêI·ªÄU CH·ªàNH RI√äNG CHO MOBILE (QUAN TR·ªåNG NH·∫§T) --- */
@media (max-width: 480px) {
    .deposit-box {
        /* Gi·∫£m ƒë·ªám (padding) c·ªßa c·∫£ h·ªôp ƒë·ªÉ l·∫•y th√™m kh√¥ng gian cho ch·ªØ */
        padding: 15px 10px !important; 
    }
    
    .deposit-box ul {
        /* ƒê·∫£m b·∫£o danh s√°ch s√°t l·ªÅ tr√°i nh·∫•t c√≥ th·ªÉ */
        margin-left: 0 !important;
        padding-left: 0 !important;
    }
    
    .deposit-box li {
        font-size: 0.9em; /* Gi·∫£m c·ª° ch·ªØ 1 ch√∫t x√≠u tr√™n mobile ƒë·ªÉ v·ª´a d√≤ng h∆°n */
    }
    
    /* N·∫øu t√™n ng√¢n h√†ng qu√° d√†i, cho ph√©p ti√™u ƒë·ªÅ (Ng√¢n h√†ng:) r·ªõt d√≤ng n·∫øu c·∫ßn thi·∫øt */
    /* Ho·∫∑c gi·ªØ nowrap nh∆∞ng ch·∫•p nh·∫≠n n·ªôi dung xu·ªëng d√≤ng */
    .deposit-box li strong {
        min-width: auto; /* ƒê·ªÉ t·ª± ƒë·ªông co d√£n */
    }
}
/* =========================================
   CSS TH·∫∫ TH√ÄNH VI√äN CAO C·∫§P (PREMIUM CARD)
   ========================================= */

/* 1. KHUNG CH√çNH C·ª¶A TH·∫∫ */
.student-profile-box {
    /* N·ªÅn Gradient nh·∫π: T·ª´ tr·∫Øng sang kem ·∫•m -> T·∫°o ƒë·ªô sang */
    background: linear-gradient(145deg, #FFFFFF 60%, #FFFBEB 100%);
    
    /* Vi·ªÅn: M√†u v√†ng kem nh·∫°t thay v√¨ x√°m */
    border: 1px solid #FEE2B5;
    
    /* Bo g√≥c tr√≤n h∆°n cho m·ªÅm m·∫°i */
    border-radius: 20px;
    
    /* ƒê·ªï b√≥ng 2 l·ªõp: 1 l·ªõp b√≥ng x√°m t·∫°o ƒë·ªô n·ªïi, 1 l·ªõp b√≥ng cam nh·∫π t·∫°o hi·ªáu ·ª©ng ph√°t s√°ng (glow) */
    box-shadow: 
        0 10px 25px -5px rgba(0, 0, 0, 0.05), 
        0 5px 10px -5px rgba(245, 158, 11, 0.08);
        
    padding: 25px; /* TƒÉng padding cho tho√°ng */
    margin-top: 20px;
    margin-bottom: 25px;
    text-align: left;
    position: relative;
    overflow: hidden; /* ƒê·ªÉ c·∫Øt g√≥c cho thanh m√†u b√™n tr√°i */
}

/* Thanh m√†u trang tr√≠ b√™n tr√°i (Accent Bar) */
.student-profile-box::before {
    content: "";
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 6px; /* D√†y h∆°n m·ªôt ch√∫t */
    /* Gradient cam ch√°y r·ª±c r·ª° */
    background: linear-gradient(to bottom, #FBBF24, #D97706); 
}

/* 2. H√ÄNG TI√äU ƒê·ªÄ (T√™n & M√£) */
.profile-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 15px;
    /* ƒê∆∞·ªùng k·∫ª ngƒÉn c√°ch m√†u v√†ng nh·∫°t */
    border-bottom: 1px dashed #FCD34D;
}

/* T√™n (Gi·ªØ nguy√™n hi·ªáu ·ª©ng n·ªïi b·∫≠t ƒë√£ l√†m tr∆∞·ªõc ƒë√≥) */
.profile-name {
    font-size: 1.4em;
    font-weight: 900;
    color: #D97706; 
    background: linear-gradient(90deg, #D97706, #F59E0B);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-shadow: 0px 2px 4px rgba(245, 158, 11, 0.15);
}

/* Huy hi·ªáu M√£ ID */
.profile-id-badge {
    /* N·ªÅn cam nh·∫°t */
    background-color: #FFF7ED;
    /* Ch·ªØ n√¢u cam ƒë·∫≠m */
    color: #9A3412;
    padding: 5px 14px;
    border-radius: 30px; /* Bo tr√≤n ki·ªÉu vi√™n thu·ªëc */
    font-size: 0.9em;
    font-weight: 700;
    /* Vi·ªÅn cam nh·∫π */
    border: 1px solid #FFEDD5;
    display: flex; align-items: center; gap: 6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

/* 3. H√ÄNG LI√äN H·ªÜ */
.profile-contact-row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px;
    color: #57534E; /* M√†u ch·ªØ x√°m ·∫•m */
    font-size: 0.95em;
    font-weight: 500;
}

.profile-item {
    display: flex;
    align-items: center;
    gap: 8px;
}
.profile-item svg { 
    width: 18px; height: 18px; 
    color: #F59E0B; /* Icon m√†u cam v√†ng */
    filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
}

/* 4. KHU V·ª∞C L·ªäCH S·ª¨ H·ªåC T·∫¨P */
.class-history {
    /* N·ªÅn m√†u kem r·∫•t nh·∫°t, t√°ch bi·ªát nh·∫π nh√†ng */
    background-color: #FFFCF8;
    border: 1px solid #FFF3E0;
    padding: 12px 15px;
    border-radius: 12px;
}

.class-history-label {
    font-size: 0.85em;
    color: #A16207; /* M√†u n√¢u v√†ng */
    font-weight: 700;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex; align-items: center; gap: 5px;
}
/* Th√™m icon nh·ªè tr∆∞·ªõc nh√£n l·ªãch s·ª≠ */
.class-history-label::before { content: "üìö"; font-size: 1.1em; }

.class-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

/* Th·∫ª Tag l·ªõp h·ªçc (Th∆∞·ªùng) */
.class-tag {
    padding: 5px 14px;
    border-radius: 8px;
    font-size: 0.85em;
    font-weight: 600;
    background-color: #FFFFFF;
    border: 1px solid #E5E7EB;
    color: #374151;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    transition: all 0.2s;
}
.class-tag:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.08); }

/* Tag VIP n·ªïi b·∫≠t (Gi·ªØ nguy√™n v√¨ ƒë√£ ƒë·∫πp) */
.class-tag.vip {
    background-color: #ECFDF5;
    color: #047857;
    border-color: #6EE7B7;
    box-shadow: 0 2px 4px rgba(5, 150, 105, 0.1);
}
/* --- H·ªòP M√î T·∫¢ KH√ìA H·ªåC (PHI√äN B·∫¢N HIGHLIGHT) --- */
.course-description-box {
    /* N·ªÅn xanh d∆∞∆°ng si√™u nh·∫°t (t·∫°o c·∫£m gi√°c tho√°ng ƒë√£ng) */
    background-color: #F0F9FF; 
    
    /* Vi·ªÅn tr√°i: Xanh d∆∞∆°ng t∆∞∆°i (gi·ªØ nguy√™n nh·∫≠n di·ªán th√¥ng tin) */
    border-left: 5px solid #3B82F6; 
    
    border-radius: 8px;
    padding: 20px;
    margin-top: 15px;
    margin-bottom: 25px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    
    font-size: 0.95em;
    color: #334155; /* M√†u n·ªôi dung x√°m ƒëen */
    line-height: 1.6;
    
    display: none; 
    animation: fadeIn 0.4s ease-out;
    position: relative;
}

/* 1. TI√äU ƒê·ªÄ: XANH ƒê·∫¨M (TIN C·∫¨Y) */
.course-description-box .desc-title {
    display: flex;
    align-items: center;
    
    /* M√†u Xanh Ho√†ng Gia ƒê·∫≠m -> T·∫°o s·ª± uy t√≠n */
    color: #1E3A8A; 
    
    font-weight: 800; /* Ch·ªØ ƒë·∫≠m h∆°n ch√∫t n·ªØa */
    font-size: 1.1em;
    margin-bottom: 10px;
    text-transform: uppercase; /* Vi·∫øt hoa ƒë·ªÉ l√†m ti√™u ƒë·ªÅ n·ªïi h∆°n */
    letter-spacing: 0.5px;
}

.course-description-box .desc-title::before {
    content: "üí°";
    margin-right: 10px;
    font-size: 1.2em;
}

/* N·ªôi dung m√¥ t·∫£ */
.course-description-box .desc-content {
    margin-bottom: 15px;
    color: #475569;
}

/* 2. NG√ÄY KHAI GI·∫¢NG: CAM ƒê·∫§T (N·ªîI B·∫¨T & TH√öC GI·ª§C) */
/* --- Tinh ch·ªânh ng√†y khai gi·∫£ng cho tinh t·∫ø h∆°n --- */
.course-description-box .desc-date {
    /* ƒê∆∞·ªùng k·∫ª ngƒÉn c√°ch m·ªù m√†u xanh nh·∫°t */
    border-top: 1px dashed #BAE6FD; 
    
    padding-top: 12px;
    margin-top: 8px;
    
    /* M√†u ch·ªØ: Cam ch√°y (Cam ƒë·∫≠m) -> R·∫•t n·ªïi tr√™n n·ªÅn xanh m√† kh√¥ng c·∫ßn t√¥ n·ªÅn */
    color: #C2410C; 
    
    font-weight: 700;
    font-size: 1.1em; /* TƒÉng c·ª° ch·ªØ l√™n x√≠u cho r√µ */
    display: flex;
    align-items: center;
    
    /* [QUAN TR·ªåNG] B·ªé d√≤ng background m√†u v√†ng ƒëi */
    /* background: rgba(254, 243, 199, 0.5); <--- X√ìA D√íNG N√ÄY */
    background: transparent; 
    padding-bottom: 0;
}

/* L√†m icon l·ªãch to h∆°n m·ªôt ch√∫t ƒë·ªÉ l√†m ƒëi·ªÉm nh·∫•n */
.course-description-box .desc-date::before {
    content: "üìÖ";
    margin-right: 10px;
    font-size: 1.3em; 
    filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1)); /* ƒê·ªï b√≥ng nh·∫π cho icon */
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}
/* --- CSS TH·∫∫ TH√îNG TIN H·ªåC VI√äN (MEMBER CARD) --- */
.student-profile-box {
    background-color: #FFFFFF;
    border: 1px solid #E5E7EB;
    border-radius: 12px;
    padding: 15px 20px;
    margin-top: 15px;
    margin-bottom: 10px;
    text-align: left;
    box-shadow: 0 2px 4px rgba(0,0,0,0.03);
}

.profile-row {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 8px;
    font-size: 0.95em;
    color: #4B5563;
}

.profile-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

/* Icon nh·ªè cho t·ª´ng m·ª•c */
.profile-item svg { width: 16px; height: 16px; color: #9CA3AF; }

/* Danh s√°ch c√°c l·ªõp ƒë√£ h·ªçc (Tags) */
.class-history {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px dashed #E5E7EB;
}
.class-history-label {
    font-size: 0.85em;
    color: #6B7280;
    margin-bottom: 6px;
    font-weight: 600;
    text-transform: uppercase;
}
.class-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}
.class-tag {
    background-color: #F3F4F6;
    color: #374151;
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 0.85em;
    font-weight: 500;
    border: 1px solid #D1D5DB;
}
/* Tag ƒë·∫∑c bi·ªát cho l·ªõp VIP */
.class-tag.vip {
    background-color: #ECFDF5; /* Xanh l√° nh·∫°t */
    color: #059669;
    border-color: #A7F3D0;
}
/* --- HUY HI·ªÜU VIP (STYLE V√ÄNG KEM S√ÅNG - CH·ªÆ ƒê·ªíNG ƒê·∫¨M - R√ï N√âT) --- */
.vip-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;

    /* 1. N·ªÅn: Gradient V√†ng Kem S√°ng (R·∫•t nh·∫°t, t·∫°o ƒë·ªô b√≥ng nh·∫π) */
    background: linear-gradient(to bottom, #FFFBEB 30%, #FFF3C4 100%);

    /* 2. Ch·ªØ: M√†u N√¢u ƒê·ªìng ƒê·∫≠m (C·ª±c n·ªïi tr√™n n·ªÅn s√°ng) */
    color: #854D0E; /* M√†u n√¢u v√†ng ƒë·∫≠m */

    /* [C·ª∞C K·ª≤ QUAN TR·ªåNG] Ph·∫£i ƒë·∫∑t l·∫°i fill-color tr√πng m√†u ch·ªØ ƒë·ªÉ n√≥ hi·ªán ra */
    -webkit-text-fill-color: #854D0E;

    /* 3. Vi·ªÅn: V√†ng ngh·ªá ƒë·ªÉ t·∫°o khu√¥n */
    border: 1px solid #F59E0B;

    font-size: 0.95em;
    font-weight: 900; /* Si√™u ƒë·∫≠m */
    text-transform: uppercase;
    letter-spacing: 0.5px;

    padding: 4px 12px;
    border-radius: 20px;
    margin-left: 0px;
    vertical-align: middle;

    /* B√≥ng nh·∫π t·∫°o ƒë·ªô n·ªïi 3D */
    box-shadow: 0 2px 4px rgba(133, 77, 14, 0.15);
    transform: none;

    user-select: none;
}
/* Hi·ªáu ·ª©ng ch·ªØ ch·∫°y l·∫•p l√°nh */
@keyframes shine {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Tr√™n ƒëi·ªán tho·∫°i th√¨ cho xu·ªëng d√≤ng n·∫øu t√™n d√†i qu√° */
@media (max-width: 480px) {
    .vip-badge {
        display: inline-flex;
        margin-left: 0;
        margin-top: 5px;
    }
}
/* --- HUY HI·ªÜU TH√ÄNH VI√äN (STYLE TEAL - THANH L·ªäCH & KHI√äM T·ªêN) --- */
.member-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    
    /* N·ªÅn: Xanh ng·ªçc r·∫•t nh·∫°t (M√°t m·∫Øt) */
    background: linear-gradient(135deg, #F0FDFA 0%, #CCFBF1 100%);
    
    /* Vi·ªÅn: Xanh ng·ªçc nh·∫°t */
    border: 1px solid #5EEAD4;
    
    /* Ch·ªØ: Xanh c·ªï v·ªãt ƒë·∫≠m (T∆∞∆°ng ph·∫£n t·ªët, nh√¨n tri th·ª©c) */
    color: #0F766E;
    
    /* √âp m√†u ch·ªØ */
    -webkit-text-fill-color: #0F766E;
    
    font-size: 0.95em;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    
    padding: 4px 12px;
    border-radius: 20px;
    margin-left: 10px;
    vertical-align: middle;
    
    /* B√≥ng r·∫•t nh·∫π */
    box-shadow: 0 2px 4px rgba(15, 118, 110, 0.1);
    transform: translateY(-3px);
    
    user-select: none;
}
/* --- ƒêI·ªÄU CH·ªàNH RI√äNG CHO ƒêI·ªÜN THO·∫†I (MOBILE RESPONSIVE) --- */
@media (max-width: 480px) {
    /* 1. Chuy·ªÉn Header Card th√†nh c·ªôt d·ªçc */
    .profile-header-row {
        flex-direction: column; /* X·∫øp ch·ªìng l√™n nhau */
        align-items: flex-start; /* CƒÉn tr√°i cho th·∫≥ng h√†ng */
        gap: 8px; /* Kho·∫£ng c√°ch gi·ªØa T√™n v√† H√†ng d∆∞·ªõi */
    }

    /* 2. T√™n h·ªçc vi√™n */
    .profile-name {
        font-size: 1.3em; /* Gi·∫£m nh·∫π c·ª° ch·ªØ cho v·ª´a m√†n h√¨nh */
        width: 100%;
        /* N·∫øu mu·ªën t√™n v√† huy hi·ªáu n·∫±m ri√™ng, ta d√πng flex wrap ·ªü ƒë√¢y */
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 10px;
    }

    /* 3. Huy hi·ªáu (Badge) v√† ID */
    /* ƒê·ªÉ Huy hi·ªáu v√† ID n·∫±m c√πng 1 h√†ng b√™n d∆∞·ªõi t√™n */
    .profile-header-row {
        position: relative;
    }
    
    /* ƒê·∫©y ID xu·ªëng d∆∞·ªõi c√πng h√†ng v·ªõi Badge */
    .profile-id-badge {
        align-self: flex-start;
        font-size: 0.95em;
        margin-top: 5px;
    }

    /* Tinh ch·ªânh l·∫°i v·ªã tr√≠ Huy hi·ªáu VIP/Th√†nh vi√™n */
    .vip-badge, .member-badge {
        margin-left: 0; /* B·ªè l·ªÅ tr√°i */
        margin-top: 5px; /* C√°ch t√™n ra m·ªôt ch√∫t */
        font-size: 0.95em; /* Nh·ªè l·∫°i x√≠u cho g·ªçn */
    }
    
    /* N·∫øu mu·ªën Huy hi·ªáu v√† ID n·∫±m ngang h√†ng nhau b√™n d∆∞·ªõi T√™n */
    /* Ch√∫ng ta c·∫ßn s·ª≠a l·∫°i c·∫•u tr√∫c HTML m·ªôt ch√∫t ho·∫∑c d√πng CSS trick n√†y */
    .profile-header-row {
        display: block; /* Ph√° v·ª° Flexbox ngang ban ƒë·∫ßu */
    }
    .profile-name {
        display: block;
        margin-bottom: 10px;
    }
    /* Gom Badge v√† ID v√†o m·ªôt d√≤ng flex m·ªõi (·∫£o) */
    .profile-header-row::after {
        content: ""; 
        display: table; 
        clear: both;
    }
    /* Cho ID bay sang ph·∫£i ho·∫∑c n·∫±m c·∫°nh badge */
    .profile-id-badge {
        display: inline-flex;
        float: right; /* ID n·∫±m b√™n ph·∫£i */
        margin-top: 0;
    }
    .vip-badge, .member-badge {
        display: inline-flex;
        float: left; /* Badge n·∫±m b√™n tr√°i */
        margin-left: 0;
        transform: none; /* B·ªè d·ªãch chuy·ªÉn cao th·∫•p */
    }
}
    </style>
</head>
<body>
    
    <div class="form-container" id="lookupSection">
        <div class="form-header">
            <h2>C·ªïng Th√¥ng Tin H·ªçc Vi√™n</h2>
            <p class="subtitle">D√†nh cho h·ªçc vi√™n ƒë√£ ƒëƒÉng k√Ω</p>
            <div style="font-size: 0.9em; margin-bottom: 20px; text-align: center;">
              <p style="margin: 5px 0;">
                    ‚ú® B·∫°n l√† h·ªçc vi√™n m·ªõi? Li√™n h·ªá ng∆∞·ªùi gi·ªõi thi·ªáu ho·∫∑c BTC 
    <a href="tel:0876473257" target="_self">0876.473.257</a>  ƒë·ªÉ l·∫•y link ƒêƒÉng k√Ω.
  </p>
            </div>
        </div>
        <div class="form-group">
            <label for="contactInput">Nh·∫≠p Email ho·∫∑c SƒêT ƒë√£ ƒëƒÉng k√Ω:</label>
            <div class="input-wrapper">
                <input type="text" id="contactInput" placeholder="VD: 0912345678 ho·∫∑c email@gmail.com">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg>
            </div>
        </div>
        <button type="button" id="findButton">T√¨m th√¥ng tin</button>
        <p id="lookupError" class="warning-text" style="display: none; margin-top: 15px; text-align: center;"></p>
    </div>

    <div class="form-container" id="dashboardSection" style="display: none;">
        
        <div class="form-header">
            <h2 style="color: #1F2937; font-size: 1.6em; text-transform: uppercase; letter-spacing: 0.5px;">
                H·ªí S∆† & L·ªò TR√åNH H·ªåC T·∫¨P
            </h2>
            
            <span id="studentName" style="display:none;"></span>
            
            <div id="studentProfileContainer" style="display:none;"></div>
            
            <p class="subtitle" style="margin-top:15px; font-style:italic;">
                L·ª±a ch·ªçn b∆∞·ªõc ƒëi ti·∫øp theo b√™n d∆∞·ªõi ƒë·ªÉ ti·∫øp t·ª•c h√†nh tr√¨nh
            </p>
        </div>
        
        <div id="upgradedBlock" class="status-box upgraded" style="display: none;">
            <div class="status-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>
            <h3>B·∫°n ƒë√£ l√† th√†nh vi√™n VIP!</h3>
            <p>H·ªá th·ªëng ghi nh·∫≠n b·∫°n ƒë√£ l√† th√†nh vi√™n c·ªßa L·ªô tr√¨nh 86 ng√†y. B·∫°n ƒë∆∞·ª£c mi·ªÖn c·ªçc khi ƒëƒÉng k√Ω c√°c l·ªõp ng·∫Øn h·∫°n b√™n d∆∞·ªõi.</p>
        </div>
        
        <div id="pendingBlock" class="status-box pending" style="display: none;">
            <div class="status-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>
            <h3>Y√™u C·∫ßu ƒêang Ch·ªù Duy·ªát</h3>
            <p>Y√™u c·∫ßu n√¢ng c·∫•p L·ªô tr√¨nh 86 ng√†y c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n v√† ƒëang ch·ªù x√°c nh·∫≠n.</p>
        </div>

        <div class="tab-container">
            <button type="button" id="shortTermTab" class="tab-button active">ƒêƒÉng k√Ω L·ªõp Ng·∫Øn H·∫°n</button>
            <button type="button" id="longTermTab" class="tab-button">N√¢ng c·∫•p L·ªô tr√¨nh 86 Ng√†y</button>
        </div>

        <div id="shortTermContent" class="tab-content active">
            <form id="formChuyenLop" novalidate>
                <input type="hidden" id="studentCodeCL">
                <input type="hidden" id="studentEmailCL">
                
                <div class="form-group">
                    <label for="classTopicCL">Ch·ªçn L·ªõp h·ªçc:</label>
                    <select id="classTopicCL" required><option value="">ƒêang t·∫£i...</option></select>
                </div>
                <div class="form-group">
                    <label for="courseSessionCL">Ch·ªçn Kh√≥a h·ªçc:</label>
                    <select id="courseSessionCL" required disabled><option value="">Vui l√≤ng ch·ªçn l·ªõp h·ªçc tr∆∞·ªõc</option></select>
                    <div id="courseDescriptionCL" class="course-description-box"></div>
                </div>
                
                <div id="waiverMessageCL" style="display:none; text-align: center; background: #F0FAF7; padding: 15px; border-radius: 8px; border: 1px solid #10B981; margin-bottom: 20px;">
                    <span style="font-size: 1.5em; vertical-align: middle;">üéâ</span>
                    <span id="waiverReasonCL" style="color: #057A55; font-weight: bold; vertical-align: middle;"></span>
                </div>
                
                <div id="depositBoxCL" style="display: none; margin-top: 20px;"></div>
                <div class="file-upload-wrapper" id="depositReceiptWrapperCL" style="display: none;">
                    <label for="depositReceiptCL">T·∫£i l√™n ·∫£nh c·ªçc cho kh√≥a h·ªçc M·ªöI:</label>
                    <input type="file" id="depositReceiptCL" accept="image/*" required>
                    <img id="filePreviewCL" class="file-preview" alt="Xem tr∆∞·ªõc ·∫£nh"/>
                </div>
                
                <div class="form-group" style="margin-top:20px;">
                    <button type="submit" id="submitButtonCL" disabled>G·ª≠i y√™u c·∫ßu ƒëƒÉng k√Ω</button>
                </div>
            </form>
        </div>
        
        <div id="longTermContent" class="tab-content">
            <form id="formNangCap">
                <form id="formNangCap">
    <div class="benefit-box">
        <div class="benefit-header">üíé ƒê·∫∂C QUY·ªÄN TH√ÄNH VI√äN 86 NG√ÄY</div>
        <ul class="benefit-list">
            <li><span class="check">‚úì</span> ƒê∆∞·ª£c h·ªó tr·ª£ <strong>ƒë·ªìng h√†nh tr·ªçn ƒë·ªùi</strong>.</li>
            <li><span class="check">‚úì</span> T·∫∑ng g√≥i <strong>Coaching 1:1 tr·ª±c ti·∫øp</strong> t·ª´ <strong>Coach C∆∞∆°ng</strong> (Tr·ªã gi√° 1.500$).</li>
            <li><span class="check">‚úì</span> ƒê∆∞·ª£c <strong>h·ªó tr·ª£ 1:1</strong> t·ª´ ng∆∞·ªùi nh·∫≠n h·ªó tr·ª£ b·∫°n.</li>
            <li><span class="check">‚úì</span> L·ªô tr√¨nh <strong>All In One</strong> - H·ªçc t·∫•t c·∫£ c√°c kh√≥a kh√°c <strong>kh√¥ng m·∫•t th√™m ph√≠ c·ªçc</strong>.</li>
            <li><span class="check">‚úì</span> M√¥i tr∆∞·ªùng <strong>k·ª∑ lu·∫≠t cao, th·ª±c chi·∫øn</strong> ra k·∫øt qu·∫£.</li>
        </ul>
    </div>

    <div class="section-title">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <span>X√°c nh·∫≠n Cam k·∫øt tham gia *</span>
    </div>
    
    <div class="form-group choice-group">
       <label>
            <input type="checkbox" name="mindsetCommitment"> 
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg></span>
            <span>T√¥i cam k·∫øt <strong>K·ª∂ LU·∫¨T - H·ªåC TH·∫¨T - L√ÄM TH·∫¨T</strong> v√† s·∫µn s√†ng h·ªó tr·ª£ ƒë·ªìng ƒë·ªôi.</span>
        </label>
        
        <label>
            <input type="checkbox" name="financialCommitment">
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg></span>
            <span>T√¥i ƒë·ªìng √Ω ƒë√≥ng c·ªçc <strong>1.686.000ƒë</strong>. Ti·ªÅn c·ªçc s·∫Ω ƒë∆∞·ª£c ho√†n khi t√¥i ho√†n th√†nh th·ª≠ th√°ch; n·∫øu b·ªè cu·ªôc, s·ªë ti·ªÅn n√†y s·∫Ω sung qu·ªπ gieo h·∫°t.</span>
        </label>
    </div>
<small id="commitmentWarningNC" class="warning-text" style="display:block; color:#666; margin-top:5px; font-style:italic;">
    üëâ Vui l√≤ng t√≠ch ch·ªçn ƒë·ªß 2 √¥ cam k·∫øt ·ªü tr√™n ƒë·ªÉ n√∫t N√¢ng c·∫•p c√≥ hi·ªáu l·ª±c.
</small> 
    <div class="deposit-box" id="depositBoxNC" style="margin-top: 20px;">
        <p>Vui l√≤ng ho√†n t·∫•t kho·∫£n ph√≠ c·ªçc <strong>1.686.000ƒë</strong> ƒë·ªÉ ch√≠nh th·ª©c ghi danh.</p>
        <ul style="padding-left: 20px;">
            <li><strong>STK:</strong> <span id="courseSTK_NC">ƒêang t·∫£i...</span></li>
            <li><strong>T√™n:</strong> <span id="courseTenTK_NC">ƒêang t·∫£i...</span></li>
            <li><strong>Ng√¢n h√†ng:</strong> <span id="courseNganHang_NC">ƒêang t·∫£i...</span></li>
            <li><strong>N·ªôi dung:</strong> <span id="paymentContentNC"></span></li>
        </ul>
        <div style="text-align: center; margin: 15px 0 5px 0; font-size: 0.9em; color: #4B5563; font-style: italic; line-height: 1.4;">
                        Ho·∫∑c Qu√©t m√£ QR b√™n d∆∞·ªõi b·∫±ng App Ng√¢n h√†ng.<br>
                        (N·∫øu ƒëang d√πng ƒëi·ªán tho·∫°i ƒë·ªÉ ƒëƒÉng k√Ω, h√£y <strong>ch·ª•p m√†n h√¨nh</strong> ·∫£nh m√£ QR n√†y r·ªìi t·∫£i l√™n trong App ƒë·ªÉ thanh to√°n)
                    </div>
        <img id="courseQR_NC" src="" alt="QR chuy·ªÉn kho·∫£n" style="display:block; max-width:180px; margin:10px auto; border-radius:8px;">
        
        <div class="file-upload-wrapper">
            <label for="depositReceiptNC">&#128221; T·∫£i l√™n ·∫£nh ch·ª•p m√†n h√¨nh ƒë√£ chuy·ªÉn c·ªçc:</label>
            <input type="file" id="depositReceiptNC" accept="image/*" required>
            <small id="depositReceiptWarningNC" class="warning-text" style="display:none;">‚ö†Ô∏è Vui l√≤ng t·∫£i l√™n ·∫£nh x√°c nh·∫≠n.</small>
            <img id="filePreviewNC" class="file-preview" alt="Xem tr∆∞·ªõc ·∫£nh"/>
        </div>
    </div>
    
    <div class="form-group" style="margin-top:20px;">
        <button type="submit" id="submitButtonNC">X√°c nh·∫≠n N√¢ng c·∫•p</button>
    </div>
</form>
        </div>
    </div>
    
    <div class="result-box" id="thankYouCL" style="display:none;">
        <div class="status-icon success" style="background-color: rgba(16, 185, 129, 0.1);"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" style="stroke: var(--success-color);"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg></div>
        <h2 id="resultTitleCL">‚úÖ G·ª≠i Y√™u C·∫ßu Th√†nh C√¥ng!</h2>
        <p id="resultTextCL"></p>
    </div>
    
    <div class="result-box" id="thankYouNC" style="display:none;">
        <div class="status-icon success" style="background-color: rgba(16, 185, 129, 0.1);"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" style="stroke: var(--success-color);"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg></div>
        <h2 style="font-size: 1.8em; font-weight: 700; margin: 0 0 10px 0;">N√¢ng c·∫•p Th√†nh C√¥ng!</h2>
        <p style="font-size: 1em; line-height: 1.6; color: var(--label-color); margin: 0 0 25px 0;">
            Ch√∫c m·ª´ng b·∫°n ƒë√£ ghi danh! B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c email x√°c nh·∫≠n sau khi ƒë∆∞·ª£c duy·ªát.
        </p>
        <a href="https://zalo.me/g/tarygl454" id="zaloLinkThankYouNC" class="result-box-button">Tham gia CLB 5 SAO</a>
    </div>

    <div id="loadingOverlay"><div class="loader"></div></div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    
    // --- 1. DOM ELEMENTS ---
    const loadingOverlay = document.getElementById("loadingOverlay");
    const dashboardSection = document.getElementById("dashboardSection");
    const studentNameSpan = document.getElementById("studentName");
    const lookupSection = document.getElementById("lookupSection");
    const lookupError = document.getElementById("lookupError");
    const findButton = document.getElementById("findButton");
    const contactInput = document.getElementById("contactInput");
    const upgradedBlock = document.getElementById("upgradedBlock");
    const pendingBlock = document.getElementById("pendingBlock");
    
    // Tab
    const shortTermTab = document.getElementById("shortTermTab");
    const longTermTab = document.getElementById("longTermTab");
    const shortTermContent = document.getElementById("shortTermContent");
    const longTermContent = document.getElementById("longTermContent");
    
    // Tab 1
    const formCL = document.getElementById("formChuyenLop");
    const studentCodeCL = document.getElementById("studentCodeCL");
    const studentEmailCL = document.getElementById("studentEmailCL");
    const classTopicCL = document.getElementById("classTopicCL");
    const courseSessionCL = document.getElementById("courseSessionCL");
    const waiverMessageCL = document.getElementById('waiverMessageCL');
    const waiverReasonCL = document.getElementById('waiverReasonCL');
    const depositBoxCL = document.getElementById('depositBoxCL');
    const depositReceiptWrapperCL = document.getElementById('depositReceiptWrapperCL');
    const depositReceiptCL = document.getElementById("depositReceiptCL");
    const filePreviewCL = document.getElementById("filePreviewCL");
    const submitButtonCL = document.getElementById("submitButtonCL");
    const thankYouCL = document.getElementById("thankYouCL");

    // Tab 2
    const formNC = document.getElementById("formNangCap");
    const paymentContentNC = document.getElementById("paymentContentNC");
    const depositReceiptNC = document.getElementById("depositReceiptNC");
    const filePreviewNC = document.getElementById("filePreviewNC");
    const submitButtonNC = document.getElementById("submitButtonNC");
    const readinessWarningNC = document.getElementById("readinessWarningNC");
    const principlesWarningNC = document.getElementById("principlesWarningNC");
    const benefitsWarningNC = document.getElementById("benefitsWarningNC");
    const refundCommitmentWarningNC = document.getElementById("refundCommitmentWarningNC");
    const depositReceiptWarningNC = document.getElementById("depositReceiptWarningNC");
    const thankYouNC = document.getElementById("thankYouNC");
    const elSTK_NC = document.getElementById("courseSTK_NC");
    const elTenTK_NC = document.getElementById("courseTenTK_NC");
    const elNganHang_NC = document.getElementById("courseNganHang_NC");
    const elQR_NC = document.getElementById("courseQR_NC");
    const elZaloThankYouNC = document.getElementById("zaloLinkThankYouNC");

    // --- 2. STATE ---
    let globalStudentInfo = {};
    let allCourseData = {};
    let fileDataCL = { base64: null, name: null, type: null };
    let fileDataNC = { base64: null, name: null, type: null };
    let isDepositWaivedCL = false;
    
    const DEFAULT_STK = "0912426481";
    const DEFAULT_TEN_CHU_TK = "NGUYEN BIEN CUONG";
    const DEFAULT_NGAN_HANG = "SACOMBANK";
    const DEFAULT_QR_LINK = "https://i.postimg.cc/P54WkfFV/qr.jpg";
    const DEFAULT_ZALO_LINK = "https://zalo.me/g/tarygl454";

    // --- 3. LISTENERS ---
    findButton.addEventListener("click", findStudent);
    // Enter key for search
    contactInput.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            findButton.click();
        }
    });

    shortTermTab.addEventListener("click", () => switchTab('short-term'));
    longTermTab.addEventListener("click", () => switchTab('long-term'));

    classTopicCL.addEventListener('change', handleClassTopicChangeCL);
    courseSessionCL.addEventListener('change', handleCourseSessionChangeCL);
    depositReceiptCL.addEventListener("change", (e) => handleFileUpload(e, filePreviewCL, (data) => fileDataCL = data));
    formCL.addEventListener("submit", handleSubmitCL);

    depositReceiptNC.addEventListener("change", (e) => handleFileUpload(e, filePreviewNC, (data) => fileDataNC = data));
    formNC.addEventListener("submit", handleSubmitNC);

    // --- 4. FUNCTIONS ---

    function findStudent() {
        lookupError.style.display = 'none';
        const contact = contactInput.value.trim();
        if (!contact) {
            lookupError.textContent = "Vui l√≤ng nh·∫≠p Email ho·∫∑c SƒêT.";
            lookupError.style.display = 'block';
            return;
        }
        
        // Clear previous errors
        lookupError.style.display = 'none';
        loadingOverlay.style.display = 'flex';
        
        // G·ªçi Server
        google.script.run
            .withSuccessHandler(onDashboardFound)
            .withFailureHandler(onLookupFailure)
            .getStudentDashboard(contact);
    }

    function onLookupFailure(error) {
        loadingOverlay.style.display = 'none';
        lookupError.textContent = error.message || "L·ªói k·∫øt n·ªëi ho·∫∑c kh√¥ng t√¨m th·∫•y th√¥ng tin.";
        lookupError.style.display = 'block';
    }

    function onDashboardFound(data) {
        if (!data || !data.success) {
            onLookupFailure(data || { message: "Kh√¥ng c√≥ ph·∫£n h·ªìi t·ª´ server." });
            return;
        }
        
        globalStudentInfo = data;
        
        studentNameSpan.textContent = data.name;
        studentCodeCL.value = data.code;
        studentEmailCL.value = data.email;
        paymentContentNC.textContent = `${data.code} Coc 86 ngay`;

        // --- HI·ªÇN TH·ªä TH·∫∫ H·ªåC VI√äN (C√ì VIP BADGE) ---
        const profileContainer = document.getElementById("studentProfileContainer");
        if (profileContainer) {
            // 1. X·ª≠ l√Ω Tags (Gi·ªØ nguy√™n)
            let classTagsHTML = '<span style="color:#999; font-style:italic;">Ch∆∞a tham gia l·ªõp n√†o</span>';
            if (data.registeredCourseTopics && data.registeredCourseTopics.length > 0) {
                classTagsHTML = data.registeredCourseTopics.map(topic => {
                    const isVIP = String(topic).toLowerCase().includes("86 ng√†y");
                    const className = isVIP ? "class-tag vip" : "class-tag";
                    return `<span class="${className}">${topic}</span>`;
                }).join("");
            }

            // 2. [M·ªöI] X·ª≠ l√Ω Huy hi·ªáu VIP
            let badgeHTML = "";
            
            if (data.status_86_day === "ALREADY_UPGRADED") {
                // N·∫øu l√† VIP -> Hi·ªán Huy hi·ªáu V√†ng
                badgeHTML = `<span class="vip-badge">üëë VIP </span>`;
            } else {
                // Icon Ng∆∞·ªùi d√πng d·∫°ng Solid (Kh·ªëi ƒë·∫∑c) m√†u x√°m ƒë·∫≠m
                const idIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="14" height="14" style="color:#0F766E; margin-bottom:1px;">
                    <path fill-rule="evenodd" d="M4.5 3.75a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V6.75a3 3 0 0 0-3-3h-15Zm4.125 3a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Zm-3.873 8.703a4.126 4.126 0 0 1 7.746 0 .75.75 0 0 1-.351.92 15.02 15.02 0 0 1-7.044 0 .75.75 0 0 1-.351-.92ZM15 8.25a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" clip-rule="evenodd" />
                </svg>`;
                
                badgeHTML = `<span class="member-badge">${idIcon} TH√ÄNH VI√äN</span>`;
            
            }
            // (N·∫øu mu·ªën hi·ªán cho th√†nh vi√™n th∆∞·ªùng th√¨ th√™m else ·ªü ƒë√¢y, nh∆∞ng ƒë·ªÉ tr·ªëng cho sang)

            // 3. T·∫°o HTML
            // 2. T·∫°o HTML Th·∫ª ID (B·ªë c·ª•c Mobile: T√™n -> Badge + ID chia ƒë√¥i)
            profileContainer.innerHTML = `
                <div class="student-profile-box">
                    <div style="border-bottom: 1px dashed #FCD34D; padding-bottom: 15px; margin-bottom: 15px;">
                        
                        <div class="profile-name" style="margin-bottom: 12px;">
                            ${data.name}
                        </div>

                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            
                            <div style="flex-shrink: 0;">
                                ${badgeHTML}
                            </div>

                            <div class="profile-id-badge">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" style="width:14px;height:14px;"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                                M√£ H·ªçc Vi√™n: ${data.code}
                            </div>
                        </div>
                    </div>

                    <div class="profile-contact-row">
                        <div class="profile-item" style="margin-right: 15px;">
                            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0Q5NzcwNiI+PHBhdGggZD0iTTIwLjAxIDE1LjM4Yy0xLjIzIDAtMi40Mi0uMi0zLjUzLS41NmEuOTc3Ljk3NyAwIDAwLTEuMDEuMjRsLTEuNTcgMS45N2MtMi44My0xLjQ5LTUuMTUtMy44LTYuNjQtNi42NGwxLjk3LTEuNTdjLjIzLS4yMy4zMS0uNTYuMjUtLjg3LS4zNi0xLjExLS41Ni0yLjMtLjU2LTMuNTMgMC0uNTQtLjQ1LS45OS0uOTktLjk5SDQuMTlDMy42NSAzLjQzIDMgMy45NyAzIDQuNjljMCA4LjkgNy40MyAxNi4zMSAxNi4zMSAxNi4zMS43MiAwIDEuMjYtLjY1IDEuMjYtMS4xOXYtMy40NGMwLS41NC0uNDUtLjk5LS45OS0uOTl6Ii8+PC9zdmc+" 
                                 alt="Phone" 
                                 style="width:20px; height:20px; vertical-align: middle; margin-right: 5px;" />
                            
                            <span style="font-weight: 700; color: #374151; font-size: 1.1em;">
                                ${data.phone || "Ch∆∞a c·∫≠p nh·∫≠t SƒêT"}
                            </span>
                        </div>
                        
                        <div class="profile-item">
                            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzlDQTNBRiI+PHBhdGggZD0iTTEuNSA4LjY3djguNThhMyAzIDAgMDAzIDNoMTVhMyAzIDAgMDAzLTNWOC42N2wtOC45MjggNS40OTNhMyAzIDAgMDEtMy4xNDQgMEwxLjUgOC42N3oiIC8+PHBhdGggZD0iTTIyLjUgNi45MDhWNi43NWEzIDMgMCAwMC0zLTNoLTE1YTMgMyAwIDAwLTMgM3YuMTU4bDkuNzE0IDUuOTc4YTEuNSAxLjUgMCAwMDEuNTcyIDBMMjIuNSA2LjkwOHoiIC8+PC9zdmc+" 
                                 alt="Email" 
                                 style="width:20px; height:20px; vertical-align: middle; margin-right: 5px;" />
                                 
                            <span>${data.email || "---"}</span>
                        </div>
                    </div>
                    
                    <div class="class-history">
                        <div class="class-history-label">C√°c l·ªõp ƒë√£ tham gia:</div>
                        <div class="class-tags">
                            ${classTagsHTML}
                        </div>
                    </div>
                </div>
            `;
            profileContainer.style.display = "block";
        }

        if (data.status_86_day === "ALREADY_UPGRADED") {
            upgradedBlock.style.display = 'flex';
            pendingBlock.style.display = 'none';
            longTermTab.style.display = 'none'; 
            switchTab('short-term'); 
        } else if (data.status_86_day === "PENDING") {
            upgradedBlock.style.display = 'none';
            pendingBlock.style.display = 'flex';
            longTermTab.style.display = 'none'; 
            switchTab('short-term'); 
        } else {
            upgradedBlock.style.display = 'none';
            pendingBlock.style.display = 'none';
            longTermTab.style.display = 'block';
            switchTab('short-term');
        }

        loadInitialData(); 
        lookupSection.style.display = 'none';
        dashboardSection.style.display = 'block';
    }
    
    function loadInitialData() {
        google.script.run
            .withSuccessHandler(onAllDataLoaded)
            .withFailureHandler(onLoadDataFailure)
            .getAllCourseDetails(new Date().getTime());
            
        google.script.run
            .withSuccessHandler(populateNangCapInfo)
            ._getCourseInfo("86D");
    }
    
    function onLoadDataFailure(error) {
        loadingOverlay.style.display = 'none';
        alert("L·ªói t·∫£i d·ªØ li·ªáu kh√≥a h·ªçc: " + error.message);
    }
    
    function onAllDataLoaded(courses) {
        allCourseData = courses;
        const allTopics = [...new Set(Object.values(allCourseData).map(c => c.topic))];
        const topicsForCL = allTopics.filter(t => t && !String(t).toLowerCase().includes("86 ng√†y"));
        populateClassTopicsCL(topicsForCL);
        loadingOverlay.style.display = 'none';
    }

    function switchTab(tabName) {
        if (tabName === 'short-term') {
            shortTermTab.classList.add('active');
            longTermTab.classList.remove('active');
            shortTermContent.style.display = 'block';
            longTermContent.style.display = 'none';
        } else {
            shortTermTab.classList.remove('active');
            longTermTab.classList.add('active');
            shortTermContent.style.display = 'none';
            longTermContent.style.display = 'block';
        }
    }

    // --- TAB 1 LOGIC ---
    
    function populateClassTopicsCL(topics) {
        classTopicCL.innerHTML = "<option value=''>-- Vui l√≤ng ch·ªçn --</option>";
        if (topics && topics.length > 0) {
            // Chu·∫©n h√≥a danh s√°ch ƒë·ªÉ so s√°nh
            const registered = (globalStudentInfo.registeredCourseTopics || []).map(t => String(t).toLowerCase().trim());
            const pending = (globalStudentInfo.pendingCourseTopics || []).map(t => String(t).toLowerCase().trim());

            topics.forEach(topic => {
                const option = document.createElement("option");
                const topicLower = String(topic).toLowerCase().trim();
                option.value = topic;

                if (registered.includes(topicLower)) {
                    option.textContent = topic + " (ƒê√£ tham gia)";
                    option.disabled = true;
                } else if (pending.includes(topicLower)) {
                    option.textContent = topic + " (ƒêang ch·ªù duy·ªát)";
                    option.disabled = true;
                } else {
                    option.textContent = topic;
                }
                classTopicCL.appendChild(option);
            });
        } else {
            classTopicCL.innerHTML = "<option value=''>Kh√¥ng c√≥ l·ªõp h·ªçc n√†o</option>";
        }
    }

    function populateCourseSessionsCL(courses) {
        courseSessionCL.innerHTML = "<option value=''>-- Vui l√≤ng ch·ªçn --</option>";
        if (courses && courses.length > 0) {
            courses.forEach(course => {
                const option = document.createElement("option");
                option.value = course.code;
                option.textContent = course.name;
                courseSessionCL.appendChild(option);
            });
            courseSessionCL.disabled = false;
        } else {
            courseSessionCL.innerHTML = "<option value=''>Ch∆∞a c√≥ kh√≥a h·ªçc cho l·ªõp n√†y</option>";
        }
    }
    
    function handleClassTopicChangeCL() {
        const selectedTopic = this.value;
        courseSessionCL.innerHTML = '<option value="">-- Vui l√≤ng ch·ªçn --</option>';
        courseSessionCL.disabled = true;
        submitButtonCL.disabled = true;
        updateDepositInfoCL(null);
        waiverMessageCL.style.display = 'none';
        
        // ·∫®n m√¥ t·∫£ c≈©
        const descBox = document.getElementById("courseDescriptionCL");
        if(descBox) { descBox.style.display = 'none'; descBox.innerHTML = ""; }

        if (!selectedTopic) return;
        
        const coursesInTopic = Object.values(allCourseData).filter(c => c.topic === selectedTopic);
        populateCourseSessionsCL(coursesInTopic);

        if (coursesInTopic.length === 1) {
            courseSessionCL.value = coursesInTopic[0].code;
            handleCourseSessionChangeCL.call(courseSessionCL);
        }
    }

    function handleCourseSessionChangeCL() {
        const selectedCourseCode = this.value;
        const submitButtonCL = document.getElementById("submitButtonCL");
        if(submitButtonCL) submitButtonCL.disabled = true;

        // [LOGIC M·ªöI] X·ª≠ l√Ω hi·ªÉn th·ªã m√¥ t·∫£ + Ng√†y khai gi·∫£ng
        const descBox = document.getElementById("courseDescriptionCL");
        const courseInfo = allCourseData ? allCourseData[selectedCourseCode] : null;
        
        if (descBox) {
        if (courseInfo) {
            let htmlContent = "";

            // 1. Ph·∫ßn M√¥ t·∫£ (Lu√¥n hi·ªán ti√™u ƒë·ªÅ)
            if (courseInfo.description) {
                htmlContent += `<div class="desc-title">M√¥ t·∫£ kh√≥a h·ªçc</div>
                                <div class="desc-content">${courseInfo.description}</div>`;
            }

            // 2. Ph·∫ßn Ng√†y khai gi·∫£ng
            if (courseInfo.startDate) {
                // N·∫øu ch∆∞a c√≥ n·ªôi dung b√™n tr√™n th√¨ v·∫´n c·∫ßn div m·ªü ƒë·∫ßu
                if (!htmlContent) htmlContent += `<div class="desc-title">M√¥ t·∫£ kh√≥a h·ªçc</div>`;
                
                htmlContent += `<div class="desc-date">
                                    Khai gi·∫£ng: ${courseInfo.startDate}
                                </div>`;
            }

            // 3. Render
            if (htmlContent) {
                descBox.innerHTML = htmlContent;
                descBox.style.display = 'block';
            } else {
                descBox.style.display = 'none';
            }
        } else {
            descBox.style.display = 'none';
        }
    }

        if (!selectedCourseCode) {
            updateDepositInfoCL(null);
            waiverMessageCL.style.display = 'none';
            return;
        }

        if (courseInfo && (courseInfo.depositFee === 0 || courseInfo.depositFee === "0")) {
            isDepositWaivedCL = true;
            waiverMessageCL.style.display = 'block';
            waiverReasonCL.textContent = "Kh√≥a h·ªçc mi·ªÖn ph√≠ ‚Äî b·∫°n kh√¥ng c·∫ßn ƒë√≥ng c·ªçc.";
            depositBoxCL.style.display = 'none';
            depositReceiptWrapperCL.style.display = 'none';
            submitButtonCL.disabled = false;
            return;
        }

        const waiverResult = checkWaiverStatusLocallyCL(selectedCourseCode);

        if (waiverResult.isWaived) {
            isDepositWaivedCL = true;
            waiverMessageCL.style.display = 'block';
            waiverReasonCL.textContent = waiverResult.reason;
            depositBoxCL.style.display = 'none';
            depositReceiptWrapperCL.style.display = 'none';
        } else {
            isDepositWaivedCL = false;
            waiverMessageCL.style.display = 'none';
            updateDepositInfoCL(courseInfo); 
            depositBoxCL.style.display = 'block';
            depositReceiptWrapperCL.style.display = 'block';
        }
        submitButtonCL.disabled = false;
    }

    function checkWaiverStatusLocallyCL(newCourseCode) {
    const newCourseInfo = allCourseData[newCourseCode];
    if (!newCourseInfo) return { isWaived: false };

    const newTopic = String(newCourseInfo.topic).toLowerCase().trim();
    const registered = (globalStudentInfo.registeredCourseTopics || []).map(t => String(t).toLowerCase().trim());

    // 1. ƒêang l√† VIP 86 th√¨ mi·ªÖn h·∫øt (tr·ª´ khi ƒëƒÉng k√Ω l·∫°i ch√≠nh 86)
    if (registered.includes("86 ng√†y ƒë·ªìng h√†nh") && newTopic !== "86 ng√†y ƒë·ªìng h√†nh") {
        return { isWaived: true, reason: "B·∫°n ƒë∆∞·ª£c mi·ªÖn c·ªçc v√¨ ƒëang tham gia L·ªô tr√¨nh 86 ng√†y." };
    }

    // 2. ƒê√£ h·ªçc l·ªõp n√†y r·ªìi (H·ªçc l·∫°i) -> Mi·ªÖn c·ªçc
    if (registered.includes(newTopic)) {
        return { isWaived: true, reason: `B·∫°n ƒë∆∞·ª£c mi·ªÖn c·ªçc v√¨ ƒë√£ tham gia l·ªõp "${newCourseInfo.topic}" tr∆∞·ªõc ƒë√≥.` };
    }

    // 3. [S·ª¨A ƒê·ªîI] ƒê√£ h·ªçc Video ra ƒë∆°n -> ƒêƒÉng k√Ω Ti·∫øp th·ªã li√™n k·∫øt -> Mi·ªÖn c·ªçc
    // L∆∞u √Ω: C·ª•m t·ª´ "ti·∫øp th·ªã li√™n k·∫øt" ph·∫£i kh·ªõp v·ªõi T√™n l·ªõp h·ªçc trong Sheet KH
    if (registered.includes("video ra ƒë∆°n") && newTopic.includes("ti·∫øp th·ªã li√™n k·∫øt")) {
        return { isWaived: true, reason: 'B·∫°n ƒë∆∞·ª£c mi·ªÖn c·ªçc l·ªõp "Ti·∫øp th·ªã li√™n k·∫øt" v√¨ ƒë√£ tham gia l·ªõp "Video ra ƒë∆°n".' };
    }

    return { isWaived: false };
}

    function updateDepositInfoCL(courseInfo) {
       if (courseInfo) {
            const formattedAmount = new Intl.NumberFormat('vi-VN').format(courseInfo.depositFee);
            
            // Icon ti·ªÅn t·ªá
            const moneyIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" /></svg>`;

            // [C·∫§U TR√öC M·ªöI]
            // 1. Ti√™u ƒë·ªÅ n·∫±m ngo√†i
            // 2. div class="deposit-box" b·ªçc l·∫•y n·ªôi dung b√™n trong
            depositBoxCL.innerHTML = `
                <div class="section-title">
                    ${moneyIcon} <span>Ph√≠ c·ªçc cam k·∫øt</span>
                </div>
                
                <div class="deposit-box" style="margin-top: 15px;">
                    <p>Ph√≠ c·ªçc cho kh√≥a h·ªçc n√†y: <strong>${formattedAmount}ƒë</strong>.</p>
                    <ul>
                        <li><strong>STK:</strong> ${courseInfo.stk || DEFAULT_STK}</li>
                        <li><strong>T√™n:</strong> ${courseInfo.tenChuTK || DEFAULT_TEN_CHU_TK}</li>
                        <li><strong>Ng√¢n h√†ng:</strong> ${courseInfo.nganHang || DEFAULT_NGAN_HANG}</li>
                        <li><strong>N·ªôi dung:</strong> ${courseInfo.paymentContent}</li>
                    </ul>
                    <div style="text-align: center; margin: 15px 0 5px 0; font-size: 0.9em; color: #4B5563; font-style: italic; line-height: 1.4;">
                        Ho·∫∑c Qu√©t m√£ QR b√™n d∆∞·ªõi b·∫±ng App Ng√¢n h√†ng.<br>
                        (N·∫øu ƒëang d√πng ƒëi·ªán tho·∫°i ƒë·ªÉ ƒëƒÉng k√Ω, h√£y <strong>ch·ª•p m√†n h√¨nh</strong> ·∫£nh m√£ QR n√†y r·ªìi t·∫£i l√™n trong App ƒë·ªÉ thanh to√°n)
                    </div>
                    <img src="${courseInfo.qrLink}" alt="QR" style="display:block; max-width:180px; margin:10px auto; border-radius:8px;">
                </div>
            `;
            depositBoxCL.style.display = 'block';
        } else {
            depositBoxCL.innerHTML = '';
            depositBoxCL.style.display = 'none';
        }
    }
    
    function handleSubmitCL(event) {
        event.preventDefault();
        const formData = {
            studentCode: studentCodeCL.value,
            studentName: studentNameSpan.textContent,
            studentEmail: studentEmailCL.value,
            newCourseCode: courseSessionCL.value,
            isWaived: isDepositWaivedCL,
            fileData: fileDataCL.base64,
            fileName: fileDataCL.name,
            fileType: fileDataCL.type
        };

        if (!formData.newCourseCode || (!isDepositWaivedCL && !formData.fileData)) {
            alert("Vui l√≤ng ch·ªçn kh√≥a h·ªçc v√† t·∫£i l√™n ·∫£nh c·ªçc (n·∫øu c√≥ y√™u c·∫ßu).");
            return;
        }

        loadingOverlay.style.display = 'flex';
        submitButtonCL.disabled = true;
        google.script.run
            .withSuccessHandler(onSuccessCL)
            .withFailureHandler(onFailure)
            .handleReRegistrationSubmit(formData);
    }
    
    function onSuccessCL(response) {
        loadingOverlay.style.display = 'none';
        if (response.success) {
            dashboardSection.style.display = 'none';
            thankYouCL.style.display = 'flex';
            
            const resultTextCL = document.getElementById("resultTextCL");
            
            // T·∫°o n√∫t Zalo b·∫±ng HTML c·ª©ng
            let btnHTML = '';
            if (response.zaloLink) {
                // G√°n ID cho n√∫t ƒë·ªÉ l√°t n·ªØa k√≠ch ho·∫°t
                btnHTML = `<a id="dynamicZaloBtnCL" class="result-box-button">V√†o nh√≥m Zalo ch·ªù duy·ªát</a>`;
            }
            
            resultTextCL.innerHTML = `${response.message}<br><br>${btnHTML}`;
            
            // [QUAN TR·ªåNG] K√≠ch ho·∫°t n√∫t v·ª´a t·∫°o b·∫±ng h√†m ƒë·∫∑c bi·ªát
            if (response.zaloLink) {
                activateZaloButton("dynamicZaloBtnCL", response.zaloLink);
            }
        } else {
            onFailure({message: response.message});
        }
    }

    // --- TAB 2 LOGIC ---
    
    function populateNangCapInfo(courseInfo) {
        let stk = DEFAULT_STK, tenChuTK = DEFAULT_TEN_CHU_TK, nganHang = DEFAULT_NGAN_HANG, qrLink = DEFAULT_QR_LINK, zaloLink = DEFAULT_ZALO_LINK;

        if (courseInfo) {
            stk = courseInfo.stk || DEFAULT_STK;
            tenChuTK = courseInfo.tenChuTK || DEFAULT_TEN_CHU_TK;
            nganHang = courseInfo.nganHang || DEFAULT_NGAN_HANG;
            qrLink = courseInfo.qrLink || DEFAULT_QR_LINK;
            zaloLink = courseInfo.zaloLink || DEFAULT_ZALO_LINK;
        }

        if(elSTK_NC) elSTK_NC.textContent = stk;
        if(elTenTK_NC) elTenTK_NC.textContent = tenChuTK;
        if(elNganHang_NC) elNganHang_NC.textContent = nganHang;
        if(elQR_NC) elQR_NC.src = qrLink;
        if(elZaloThankYouNC) elZaloThankYouNC.href = zaloLink;
    }

    function validateCheckboxGroup(selector, warningElement) {
        const checkboxes = document.querySelectorAll(selector);
        const checkedCount = document.querySelectorAll(selector + ':checked').length;
        const totalCount = checkboxes.length;
        const isValid = checkedCount === totalCount;
        warningElement.style.display = isValid ? "none" : "block";
        return isValid;
    }

    function handleSubmitNC(event) {
        event.preventDefault();

        // 1. KI·ªÇM TRA 2 CHECKBOX CAM K·∫æT
        const mindset = document.querySelector('#formNangCap input[name="mindsetCommitment"]');
        const financial = document.querySelector('#formNangCap input[name="financialCommitment"]');
        const warningEl = document.getElementById('commitmentWarningNC');

        if (!mindset.checked || !financial.checked) {
            // A. Hi·ªán ch·ªØ ƒë·ªè b√™n d∆∞·ªõi
            if(warningEl) {
                warningEl.style.display = 'block';
                warningEl.style.color = 'red';
                warningEl.style.fontWeight = 'bold';
                warningEl.textContent = "‚ö†Ô∏è B·∫°n c·∫ßn t√≠ch v√†o c·∫£ 2 √¥ cam k·∫øt ·ªü tr√™n ƒë·ªÉ ti·∫øp t·ª•c!";
            }
            
            // B. Hi·ªán Alert b·∫≠t ra gi·ªØa m√†n h√¨nh (C√°i b·∫°n ƒëang c·∫ßn)
            alert("‚ö†Ô∏è B·∫†N CH∆ØA HO√ÄN TH√ÄNH:\n\nVui l√≤ng t√≠ch ch·ªçn ƒë·ªß 2 √¥ Cam k·∫øt (K·ª∑ lu·∫≠t & T√†i ch√≠nh) ƒë·ªÉ x√°c nh·∫≠n n√¢ng c·∫•p.");
            
            return; // D·ª´ng l·∫°i, kh√¥ng g·ª≠i ƒëi
        } 
        
        // 2. KI·ªÇM TRA ·∫¢NH C·ªåC
        let isFileValid = true;
        if (!fileDataNC.base64) {
            if(depositReceiptWarningNC) depositReceiptWarningNC.style.display = 'block';
            isFileValid = false;
        } else {
             if(depositReceiptWarningNC) depositReceiptWarningNC.style.display = 'none';
        }

        if (!isFileValid) {
            alert("‚ö†Ô∏è THI·∫æU ·∫¢NH X√ÅC NH·∫¨N:\n\nVui l√≤ng t·∫£i l√™n ·∫£nh ch·ª•p m√†n h√¨nh chuy·ªÉn kho·∫£n c·ªçc.");
            return; // D·ª´ng l·∫°i
        }
        
        // 3. G·ª¨I D·ªÆ LI·ªÜU (Khi ƒë√£ ƒë·ªß h·∫øt)
        loadingOverlay.style.display = 'flex';
        submitButtonNC.disabled = true;

        const upgradeData = {
            code: globalStudentInfo.code, 
            fileData: fileDataNC.base64,
            fileName: fileDataNC.name,
            fileType: fileDataNC.type
        };

        google.script.run
            .withSuccessHandler(onSuccessNC)
            .withFailureHandler(onFailure)
            .handleUpgradeSubmit(upgradeData);
    }
    function onSuccessNC(response) {
        loadingOverlay.style.display = 'none';
        if(response.success){
            dashboardSection.style.display = 'none';
            thankYouNC.style.display = 'flex';
            
            // [QUAN TR·ªåNG] K√≠ch ho·∫°t n√∫t Zalo (ID n√∫t n√†y ƒë√£ c√≥ s·∫µn trong HTML)
            // Gi·∫£ s·ª≠ link 86D l√† c·ªë ƒë·ªãnh ho·∫∑c l·∫•y t·ª´ server, ·ªü ƒë√¢y m√¨nh v√≠ d·ª• link 86D
            activateZaloButton("zaloLinkThankYouNC", "https://zalo.me/g/tarygl454");
        } else {
            onFailure({message: response.message});
        }
    }
    
    // --- COMMON ---
    
    function handleFileUpload(event, previewElement, callback) {
        const file = event.target.files[0];
        if (!file) {
            callback({ base64: null, name: null, type: null });
            if (previewElement) previewElement.style.display = 'none';
            return;
        }
        if (file.size > 5 * 1024 * 1024) { 
             alert("L·ªói: K√≠ch th∆∞·ªõc ·∫£nh qu√° l·ªõn (t·ªëi ƒëa 5MB).");
             event.target.value = "";
             return;
        }
        const reader = new FileReader();
        reader.onload = function(e) {
            const fileData = {
                base64: e.target.result.split(',')[1],
                name: file.name,
                type: file.type
            };
            callback(fileData);
            if (previewElement) {
                previewElement.src = e.target.result;
                previewElement.style.display = 'block';
            }
        };
        reader.readAsDataURL(file);
    }

    function onFailure(error) {
        loadingOverlay.style.display = 'none';
        alert('L·ªói: ' + (error.message || "ƒê√£ c√≥ l·ªói x·∫£y ra."));
        submitButtonCL.disabled = false;
        submitButtonNC.disabled = false;
    }
    
    // --- [M·ªöI] H√ÄM T·ª∞ ƒê·ªòNG ƒê·ªîI M√ÄU L·ªúI NH·∫ÆC ---
    function setupLiveValidationNC() {
        const mindset = document.querySelector('#formNangCap input[name="mindsetCommitment"]');
        const financial = document.querySelector('#formNangCap input[name="financialCommitment"]');
        const warningLabel = document.getElementById("commitmentWarningNC");

        if (mindset && financial && warningLabel) {
            const updateStatus = () => {
                if (mindset.checked && financial.checked) {
                    // ƒê·ªß -> M√†u Xanh
                    warningLabel.style.color = "#10B981"; 
                    warningLabel.style.fontWeight = "normal";
                    warningLabel.textContent = "‚úÖ ƒê√£ x√°c nh·∫≠n ƒë·ªß cam k·∫øt.";
                } else {
                    // Thi·∫øu -> M√†u X√°m (Nh·∫Øc nh·ªü)
                    warningLabel.style.color = "#6B7280"; 
                    warningLabel.style.fontWeight = "normal";
                    warningLabel.textContent = "üëâ Vui l√≤ng t√≠ch ch·ªçn ƒë·ªß 2 √¥ cam k·∫øt ·ªü tr√™n ƒë·ªÉ n√∫t N√¢ng c·∫•p c√≥ hi·ªáu l·ª±c.";
                }
            };

            // G·∫Øn s·ª± ki·ªán click
            mindset.addEventListener('change', updateStatus);
            financial.addEventListener('change', updateStatus);
        }
    }

    // Ch·∫°y ngay khi t·∫£i trang
    setupLiveValidationNC();
});
// --- [FIX L·ªñI] H√ÄM K√çCH HO·∫†T N√öT ZALO TR√äN ƒêI·ªÜN THO·∫†I ---
    function activateZaloButton(buttonId, url) {
        const btn = document.getElementById(buttonId);
        if (!btn || !url) return;

        // 1. X√≥a href c≈© ƒë·ªÉ tr√°nh xung ƒë·ªôt
        btn.removeAttribute('href');
        
        // 2. G·∫Øn s·ª± ki·ªán Click m·∫°nh m·∫Ω h∆°n
        btn.onclick = function(e) {
            e.preventDefault();
            
            // Hi·ªáu ·ª©ng b·∫•m
            const originalText = btn.textContent;
            btn.textContent = "üîÑ ƒêang m·ªü Zalo...";
            btn.style.opacity = "0.7";
            btn.style.pointerEvents = "none"; // Ch·∫∑n b·∫•m li√™n t·ª•c

            // 3. Chi·∫øn thu·∫≠t m·ªü link ƒëa n·ªÅn t·∫£ng
            setTimeout(function() {
                // C√°ch A: M·ªü tab m·ªõi (Th∆∞·ªùng d√πng cho PC/Android)
                const newWin = window.open(url, '_blank');
                
                // C√°ch B: N·∫øu C√°ch A b·ªã ch·∫∑n (th∆∞·ªùng g·∫∑p tr√™n iPhone/Zalo Webview), d√πng chuy·ªÉn h∆∞·ªõng tr·ª±c ti·∫øp
                if (!newWin || newWin.closed || typeof newWin.closed == 'undefined') {
                    window.location.href = url;
                }

                // Kh√¥i ph·ª•c n√∫t sau 3s (ƒë·ªÉ n·∫øu l·ªói th√¨ b·∫•m l·∫°i ƒë∆∞·ª£c)
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.opacity = "1";
                    btn.style.pointerEvents = "auto";
                }, 3000);
            }, 100);
        };
    }
</script>
</body>
</html>