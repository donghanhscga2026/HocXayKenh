<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÄÄƒng KÃ½ KhÃ³a Há»c Má»›i</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      /* --- [Äá»’NG Bá»˜] Báº£ng mÃ u vÃ  style tá»« form Ä‘Äƒng kÃ½ chÃ­nh --- */
      :root { --text-color: #1F2937; --label-color: #6B7280; --input-border: #D1D5DB; --input-focus-border: #D97706; --button-bg: #F59E0B; --button-hover-bg: #D97706; --button-text-color: #FFFFFF; --box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.04); --note-bg: #F3F4F6; --input-icon-color: #9CA3AF; --input-bg: #F9FAFB; --form-bg: #FFFFFF; --selected-border: #F59E0B; --warning-color: #EF4444; --success-color: #10B981; --info-color: #3B82F6; --button-disabled-bg: #E5E7EB; --background-color: #F1F2F6; } body { font-family: 'Inter', 'Roboto', sans-serif; background-color: #F1F2F6; color: var(--text-color); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; } .form-container, .result-box { max-width: 550px; width: 100%; margin: 40px auto; background: var(--form-bg); border: 1px solid #E5E7EB; padding: 30px; border-radius: 24px; box-shadow: var(--box-shadow); } .form-header { text-align: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--input-border); } .form-header h2 { margin: 0 0 8px 0; font-size: 2.25em; font-weight: 700; color: var(--text-color); } .form-header .subtitle { font-size: 1em; color: var(--label-color); margin: 0; } .form-group { margin-bottom: 24px; } label { font-weight: 500; display: block; margin-bottom: 8px; color: var(--label-color); font-size: 0.9em; } .input-wrapper { position: relative; display: flex; align-items: center; } .input-wrapper svg { position: absolute; left: 14px; width: 20px; height: 20px; stroke: var(--input-icon-color); pointer-events: none; } input[type="text"], input[type="tel"], input[type="email"], select, textarea { width: 100%; padding: 12px 12px 12px 45px; border: 1px solid var(--input-border); border-radius: 10px; box-sizing: border-box; background-color: var(--input-bg); font-size: 1em; } select { padding-left: 12px; appearance: none; -webkit-appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="%239CA3AF" stroke-width="1.5"><path d="M7 7l3-3 3 3m0 6l-3 3-3-3" /></svg>'); background-repeat: no-repeat; background-position: right 14px center; background-size: 16px; } input:read-only { background-color: #E5E7EB; cursor: not-allowed; } button { padding: 14px 20px; background: var(--button-bg); color: var(--button-text-color); border: none; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 1.1em; width: 100%; } .deposit-box { background: var(--note-bg); padding: 20px; border-radius: 12px; } .warning-text { font-size: 0.88em; margin-top: 8px; display: none; color: var(--warning-color); } .result-box { display: none; flex-direction: column; align-items: center; text-align: center; } #loadingOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(4px); display: none; justify-content: center; align-items: center; z-index: 9999; } .loader { border: 8px solid #E5E7EB; border-top: 8px solid var(--button-bg); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.result-box-button {
  display: inline-block; /* Äá»ƒ cÃ³ thá»ƒ cÄƒn chá»‰nh padding vÃ  margin */
  padding: 12px 25px; /* KÃ­ch thÆ°á»›c nÃºt */
  margin-top: 20px; /* Khoáº£ng cÃ¡ch vá»›i vÄƒn báº£n phÃ­a trÃªn */
  background-color: #f59e0b; /* MÃ u ná»n nÃºt Zalo */
  color: #FFFFFF !important; /* MÃ u chá»¯ tráº¯ng, dÃ¹ng !important Ä‘á»ƒ ghi Ä‘Ã¨ */
  text-decoration: none !important; /* Bá» gáº¡ch chÃ¢n máº·c Ä‘á»‹nh cá»§a link */
  font-weight: 600; /* Chá»¯ Ä‘áº­m */
  font-size: 1.1em; /* KÃ­ch thÆ°á»›c chá»¯ */
  border-radius: 10px; /* Bo gÃ³c */
  transition: background-color 0.3s ease; /* Hiá»‡u á»©ng chuyá»ƒn mÃ u khi rÃª chuá»™t */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Táº¡o Ä‘á»• bÃ³ng nháº¹ */
}

.result-box-button:hover {
  background-color: #0056e6; /* MÃ u xanh Ä‘áº­m hÆ¡n khi rÃª chuá»™t */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); /* Äá»• bÃ³ng máº¡nh hÆ¡n */
}
    </style>
</head>
<body>
    <div class="form-container" id="mainContainer">
        <div id="lookupSection">
            <div class="form-header">
                <h2>ÄÄƒng KÃ½ Lá»›p Má»›i</h2>
                <p class="subtitle">DÃ nh cho há»c viÃªn Ä‘Ã£ Ä‘Äƒng kÃ½ mÃ£ sá»‘ há»c táº­p</p>
                <div style="font-size: 0.9em; margin-bottom: 20px; text-align: center;">
Â  <p style="margin: 5px 0;">
    âœ¨ Báº¡n lÃ  há»c viÃªn má»›i? LiÃªn há»‡ ngÆ°á»i giá»›i thiá»‡u hoáº·c BTC 
    <a href="tel:0876473257" target="_self">0876.473.257</a>  Ä‘á»ƒ láº¥y link ÄÄƒng kÃ½.
  </p>
Â  <p style="margin: 5px 0;">
    ğŸš€ Báº¡n muá»‘n nÃ¢ng cáº¥p lÃªn Lá»™ trÃ¬nh 86 ngÃ y? 
    
    <a href="javascript:void(0);" 
       onclick="window.open('https://www.giautoandien.site/dk5sao', '_blank')"
       style="font-weight: 700; color: var(--button-bg); text-decoration: underline;">
       Truy cáº­p trang nÃ¢ng cáº¥p
    </a>
</p>
</div>
            </div>
            <div class="form-group">
                <label for="contactInput">Nháº­p Email hoáº·c SÄT Ä‘Ã£ Ä‘Äƒng kÃ½:</label>
                <div class="input-wrapper">
                    <input type="text" id="contactInput" placeholder="VD: 0912345678 hoáº·c email@gmail.com">
                    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg>
                </div>
            </div><div id="lookupSection">
            <button id="findButton">TÃ¬m thÃ´ng tin cá»§a tÃ´i</button>
            <p id="lookupError" class="warning-text" style="display: none; margin-top: 15px; text-align: center;"></p>
        </div></div>

        <div id="studentInfoSection" style="display: none;">
            <div class="form-header">
                <h2>ChÃ o báº¡n <span id="studentName" style="color: var(--button-bg);"></span>!</h2>
                <p class="subtitle">Vui lÃ²ng chá»n khÃ³a há»c má»›i báº¡n muá»‘n tham gia.</p>
            </div>
            <form id="reRegisterForm" novalidate>
                <input type="hidden" id="studentCode">
                <input type="hidden" id="studentEmail">
                <div id="shortTermCourseSelector">
                    <div class="form-group">
                        <label for="classTopic">Chá»n Lá»›p há»c:</label>
                        <select id="classTopic" required><option value="">Äang táº£i...</option></select>
                    </div>
                    <div class="form-group">
                        <label for="courseSession">Chá»n KhÃ³a há»c:</label>
                        <select id="courseSession" required disabled><option value="">Vui lÃ²ng chá»n lá»›p há»c trÆ°á»›c</option></select>
                        <small id="courseWarning" class="warning-text" style="display: none;">âš ï¸ Báº¡n Ä‘Ã£ Ä‘Äƒng kÃ½ lá»›p há»c nÃ y rá»“i.</small>
                    </div>
                </div>
                <div id="waiverMessage" style="display:none; text-align: center; background: #F0FAF7; padding: 15px; border-radius: 8px; border: 1px solid #10B981; margin-bottom: 20px;">
                    <span style="font-size: 1.5em; vertical-align: middle;">ğŸ‰</span>
                    <span id="waiverReason" style="color: #057A55; font-weight: bold; vertical-align: middle;"></span>
                </div>
                <div class="form-group deposit-box" id="depositBox"></div>
                <div class="file-upload-wrapper">
                    <label for="depositReceipt">Táº£i lÃªn áº£nh cá»c cho khÃ³a há»c Má»šI:</label>
                    <input type="file" id="depositReceipt" accept="image/*" required>
                    <img id="filePreview" alt="Xem trÆ°á»›c áº£nh" style="display:none; width:100%; max-width:250px; margin:15px auto; border-radius:8px;"/>
                </div>
                <div class="form-group" style="margin-top:20px;">
                    <button type="submit" id="submitButton" disabled>Gá»­i yÃªu cáº§u Ä‘Äƒng kÃ½</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="result-box" id="resultMessageContainer" style="display:none;">
        <h2 id="resultTitle"></h2>
        <p id="resultText"></p>
    </div>

    <div id="loadingOverlay"><div class="loader"></div></div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    // --- DOM Elements ---
    const lookupError = document.getElementById("lookupError");
    const findButton = document.getElementById("findButton");
    const contactInput = document.getElementById("contactInput");
    const mainContainer = document.getElementById("mainContainer");
    const lookupSection = document.getElementById("lookupSection");
    const studentInfoSection = document.getElementById("studentInfoSection");
    const studentNameSpan = document.getElementById("studentName");
    const studentCodeInput = document.getElementById("studentCode");
    const studentEmailInput = document.getElementById("studentEmail");
    const reRegisterForm = document.getElementById("reRegisterForm");
    const loadingOverlay = document.getElementById("loadingOverlay");
    const resultMessageContainer = document.getElementById("resultMessageContainer");
    const resultTitle = document.getElementById("resultTitle");
    const resultText = document.getElementById("resultText");
    const classTopicSelect = document.getElementById("classTopic");
    const courseSessionSelect = document.getElementById("courseSession");
    const submitButton = document.getElementById("submitButton");
    const depositBox = document.getElementById('depositBox');
    const depositReceiptWrapper = document.querySelector('.file-upload-wrapper');
    const waiverMessage = document.getElementById('waiverMessage');
    const waiverReason = document.getElementById('waiverReason');
    const depositReceiptInput = document.getElementById("depositReceipt");
    const filePreview = document.getElementById("filePreview");
    
    // --- State Variables ---
    let fileData = { base64: null, name: null, type: null };
    let studentRegisteredTopics = [];
    let isDepositWaived = false;
    let allCourseData = {};
    let studentPendingTopics = []; // [NÃ‚NG Cáº¤P] Biáº¿n má»›i Ä‘á»ƒ lÆ°u cÃ¡c lá»›p chá» duyá»‡t

    // --- Event Listeners ---
    findButton.addEventListener("click", findStudent);
    classTopicSelect.addEventListener('change', handleClassTopicChange);
    courseSessionSelect.addEventListener('change', handleCourseSessionChange);
    depositReceiptInput.addEventListener("change", handleFileUpload);
    reRegisterForm.addEventListener("submit", handleSubmitForm);

    // --- Main Functions ---
    function findStudent() {
      lookupError.style.display = 'none';
        const contact = contactInput.value.trim();
        if (!contact) {
            // Thay tháº¿ alert cÅ© báº±ng thÃ´ng bÃ¡o má»›i
        lookupError.textContent = "Vui lÃ²ng nháº­p Email hoáº·c SÄT.";
        lookupError.style.display = 'block';
            return;
        }
        loadingOverlay.style.display = 'flex';
    google.script.run.withSuccessHandler(onStudentFound).withFailureHandler(onStudentNotFound).findStudentByContact(contact);
}

    function onStudentFound(studentInfo) {
        if (studentInfo && studentInfo.code) {
            studentNameSpan.textContent = studentInfo.name;
            studentCodeInput.value = studentInfo.code;
            studentEmailInput.value = studentInfo.email;
            // [NÃ‚NG Cáº¤P] Láº¥y cáº£ 2 danh sÃ¡ch
            studentRegisteredTopics = (studentInfo.registeredCourseTopics || []).map(t => t.toLowerCase().trim());
            studentPendingTopics = (studentInfo.pendingCourseTopics || []).map(t => t.toLowerCase().trim());
            
google.script.run.withSuccessHandler(onAllDataLoaded).withFailureHandler(handleLoadError).getAllCourseDetails(new Date().getTime());
        } else {
            onStudentNotFound();
        }
    }
    
    function onAllDataLoaded(courses) {
        allCourseData = courses;
        const allTopics = [...new Set(Object.values(allCourseData).map(c => c.topic))];
        populateClassTopics(allTopics);
        loadingOverlay.style.display = 'none';
        lookupSection.style.display = 'none';
        studentInfoSection.style.display = 'block';
    }

    function onStudentNotFound() {
    loadingOverlay.style.display = 'none';
    lookupError.textContent = "KhÃ´ng tÃ¬m tháº¥y thÃ´ng tin. Vui lÃ²ng kiá»ƒm tra láº¡i SÄT/Email hoáº·c liÃªn há»‡ ngÆ°á»i giá»›i thiá»‡u Ä‘á»ƒ Ä‘Äƒng kÃ½ má»›i.";
    lookupError.style.display = 'block';
}

    function handleClassTopicChange() {
    const selectedTopic = this.value;

    // Reset khÃ³a
    courseSessionSelect.innerHTML = '<option value="">-- Vui lÃ²ng chá»n --</option>';
    courseSessionSelect.disabled = true;
    submitButton.disabled = true;
    updateDepositInfo(null);
    waiverMessage.style.display = 'none';

    if (!selectedTopic) return;

    // Lá»c khÃ³a theo lá»›p
    const coursesInTopic = Object.values(allCourseData).filter(c => c.topic === selectedTopic);

    populateCourseSessions(coursesInTopic);

    // âœ… Náº¿u chá»‰ cÃ³ 1 khÃ³a thÃ¬ tá»± Ä‘á»™ng chá»n luÃ´n
    if (coursesInTopic.length === 1) {
        const onlyCourse = coursesInTopic[0];

        courseSessionSelect.value = onlyCourse.code;   // Auto chá»n
        courseSessionSelect.disabled = false;

        // âœ… KÃ­ch hoáº¡t xá»­ lÃ½ thay Ä‘á»•i khÃ³a há»c
        handleCourseSessionChange.call(courseSessionSelect);
    }
}

    
    function handleCourseSessionChange() {
    const selectedCourseCode = this.value;
    submitButton.disabled = true;

    if (!selectedCourseCode) {
        updateDepositInfo(null);
        waiverMessage.style.display = 'none';
        return;
    }

    const courseInfo = allCourseData[selectedCourseCode];

    // âœ… Náº¿u khÃ³a MIá»„N PHÃ â†’ KhÃ´ng cáº§n cá»c, khÃ´ng cáº§n upload áº£nh
    if (courseInfo.depositFee === 0) {

        isDepositWaived = true;

        waiverMessage.style.display = 'block';
        waiverReason.textContent = "KhÃ³a há»c miá»…n phÃ­ â€” báº¡n khÃ´ng cáº§n Ä‘Ã³ng cá»c hoáº·c táº£i áº£nh.";

        // áº¨n pháº§n phÃ­ cá»c
        depositBox.style.display = 'none';

        // áº¨n pháº§n upload áº£nh
        depositReceiptWrapper.style.display = 'none';

        submitButton.disabled = false;
        return;
    }

    // âœ… Náº¿u KHÃ”NG pháº£i khÃ³a miá»…n phÃ­ â†’ kiá»ƒm tra miá»…n cá»c nhÆ° bÃ¬nh thÆ°á»ng
    const waiverResult = checkWaiverStatusLocally(selectedCourseCode);

    if (waiverResult.isWaived) {
        isDepositWaived = true;

        waiverMessage.style.display = 'block';
        waiverReason.textContent = waiverResult.reason;

        depositBox.style.display = 'none';
        depositReceiptWrapper.style.display = 'none';
    } else {
        isDepositWaived = false;

        waiverMessage.style.display = 'none';

        updateDepositInfo(courseInfo);
        depositBox.style.display = 'block';
        depositReceiptWrapper.style.display = 'block';
    }

    submitButton.disabled = false;
}

    // [HÃ€M Má»šI] - ToÃ n bá»™ logic kiá»ƒm tra miá»…n cá»c cháº¡y trÃªn trÃ¬nh duyá»‡t
    function checkWaiverStatusLocally(newCourseCode) {
        const newCourseInfo = allCourseData[newCourseCode];
        if (!newCourseInfo) return { isWaived: false };

        const newTopic = newCourseInfo.topic.toLowerCase().trim();
        const registered = studentRegisteredTopics;

        if (registered.includes("86 ngÃ y Ä‘á»“ng hÃ nh") && newTopic !== "86 ngÃ y Ä‘á»“ng hÃ nh") {
            return { isWaived: true, reason: "Báº¡n Ä‘Æ°á»£c miá»…n cá»c vÃ¬ Ä‘ang tham gia Lá»™ trÃ¬nh 86 ngÃ y." };
        }
        if (registered.includes(newTopic)) {
            return { isWaived: true, reason: `Báº¡n Ä‘Æ°á»£c miá»…n cá»c vÃ¬ Ä‘Ã£ tham gia lá»›p "${newCourseInfo.topic}" trÆ°á»›c Ä‘Ã³.` };
        }
        if (newTopic === "báº£n Ä‘á»“ kinh doanh online" && registered.includes("video ra Ä‘Æ¡n")) {
            return { isWaived: true, reason: 'Báº¡n Ä‘Æ°á»£c miá»…n cá»c theo chÃ­nh sÃ¡ch dÃ nh cho há»c viÃªn lá»›p "Video ra Ä‘Æ¡n".' };
        }
        return { isWaived: false };
    }
    function handleSubmitForm(event) {
        event.preventDefault();
        const formData = {
            studentCode: studentCodeInput.value,
            studentName: studentNameSpan.textContent,
            studentEmail: studentEmailInput.value,
            newCourseCode: courseSessionSelect.value,
            isWaived: isDepositWaived,
            fileData: fileData.base64,
            fileName: fileData.name,
            fileType: fileData.type
        };

        if (!formData.newCourseCode || (!isDepositWaived && !formData.fileData)) {
            alert("Vui lÃ²ng chá»n khÃ³a há»c vÃ  táº£i lÃªn áº£nh cá»c (náº¿u cÃ³ yÃªu cáº§u).");
            return;
        }

        loadingOverlay.style.display = 'flex';
        submitButton.disabled = true;
        google.script.run.withSuccessHandler(onReRegisterSuccess).withFailureHandler(onReRegisterFail).handleReRegistrationSubmit(formData);
    }
    
    // --- Helper Functions ---
    // [NÃ‚NG Cáº¤P] Cáº­p nháº­t hÃ m nÃ y Ä‘á»ƒ xá»­ lÃ½ cáº£ lá»›p Ä‘ang chá»
    function populateClassTopics(topics) {
        classTopicSelect.innerHTML = "<option value=''>-- Vui lÃ²ng chá»n --</option>";
        if (topics && topics.length > 0) {
            topics.forEach(topic => {
                if (topic && topic.toLowerCase().trim() !== "86 ngÃ y Ä‘á»“ng hÃ nh") {
                    const option = document.createElement("option");
                    const topicLower = topic.toLowerCase().trim();
                    option.value = topic;

                    if (studentRegisteredTopics.includes(topicLower)) {
                        option.textContent = topic + " (ÄÃ£ tham gia)";
                        option.disabled = true; // VÃ´ hiá»‡u hÃ³a lá»›p Ä‘Ã£ há»c
                    } else if (studentPendingTopics.includes(topicLower)) {
                        option.textContent = topic + " (Äang chá» duyá»‡t)";
                        option.disabled = true; // VÃ´ hiá»‡u hÃ³a lá»›p Ä‘ang chá»
                    } else {
                        option.textContent = topic;
                    }
                    classTopicSelect.appendChild(option);
                }
            });
        } else {
            classTopicSelect.innerHTML = "<option value=''>KhÃ´ng cÃ³ lá»›p há»c nÃ o</option>";
        }
    }
    function populateCourseSessions(courses) {
        courseSessionSelect.innerHTML = "<option value=''>-- Vui lÃ²ng chá»n --</option>";
        if (courses && courses.length > 0) {
            courses.forEach(course => {
                const option = document.createElement("option");
                option.value = course.code;
                option.textContent = course.name;
                courseSessionSelect.appendChild(option);
            });
            courseSessionSelect.disabled = false;
        } else {
            courseSessionSelect.innerHTML = "<option value=''>ChÆ°a cÃ³ khÃ³a há»c cho lá»›p nÃ y</option>";
        }
    }

    function updateDepositInfo(courseInfo) {
         if (courseInfo) {
            const formattedAmount = new Intl.NumberFormat('vi-VN').format(courseInfo.depositFee);
            depositBox.innerHTML = `<p>PhÃ­ cá»c cho khÃ³a há»c nÃ y: <strong>${formattedAmount}Ä‘</strong>.</p><ul style="margin:0 0 6px 18px;"><li><strong>STK:</strong> 1903 8297 6140 19</li><li><strong>TÃªn:</strong> NGUYEN BIEN CUONG</li><li><strong>NgÃ¢n hÃ ng:</strong> TECHCOMBANK</li><li><strong>Ná»™i dung:</strong> ${courseInfo.paymentContent}</li></ul><img src="${courseInfo.qrLink}" alt="QR" style="display:block; max-width:180px; margin:10px auto; border-radius:8px;">`;
        } else {
            depositBox.innerHTML = '';
            depositBox.style.display = 'none';
        }
    }
    
    function handleFileUpload(event) {
        const file = event.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            fileData = { base64: e.target.result.split(',')[1], name: file.name, type: file.type };
            filePreview.src = e.target.result;
            filePreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
    
    // Thay tháº¿ toÃ n bá»™ hÃ m onReRegisterSuccess

function onReRegisterSuccess(response) {
Â  Â  loadingOverlay.style.display = 'none';
Â  Â  if (response.success) {
Â  Â  Â  Â  mainContainer.style.display = 'none';
Â  Â  Â  Â  resultMessageContainer.style.display = 'flex';
Â  Â  Â  Â  resultTitle.innerHTML = "âœ… Gá»­i YÃªu Cáº§u ThÃ nh CÃ´ng!";
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  let zaloLinkHTML = '';
Â  Â  Â  Â  if (response.zaloLink) {
Â  Â  Â  Â  Â  Â  // <<< GIáº¢I PHÃP Tá»I Æ¯U Há»ŒC Tá»ª CODE Má»šI >>>
Â  Â  Â  Â  Â  Â  // Sá»­ dá»¥ng window.open cho href vÃ  onclick Ä‘á»ƒ Ã©p Zalo má»Ÿ trÃ¬nh duyá»‡t ngoÃ i
Â  Â  Â  Â  Â  Â  const openAction = `window.open('${response.zaloLink}', '_blank')`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  zaloLinkHTML = `<a href="javascript:void(0);" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onclick="${openAction}" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="result-box-button">VÃ o nhÃ³m Zalo chá» duyá»‡t</a>`;
Â  Â  Â  Â  Â  Â  // ----------------------------------------
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  zaloLinkHTML = `<a href="tel:0917138286" class="result-box-button" target="_self">LiÃªn há»‡ BTC</a>`;
Â  Â  Â  Â  }

Â  Â  Â  Â  resultText.innerHTML = `${response.message}<br><br>${zaloLinkHTML}`;
Â  Â  Â  Â  
Â  Â  } else {
Â  Â  Â  Â  onReRegisterFail({message: response.message});
Â  Â  }
}

    function onReRegisterFail(error) {
        loadingOverlay.style.display = 'none';
        alert(error.message || "ÄÃ£ cÃ³ lá»—i xáº£y ra. Vui lÃ²ng thá»­ láº¡i.");
        submitButton.disabled = false;
    }

    function handleLoadError(err) {
        loadingOverlay.style.display = 'none';
        console.error("Lá»—i táº£i dá»¯ liá»‡u tá»« server: ", err);
        alert("KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u. Vui lÃ²ng thá»­ láº¡i sau.");
    }

function setupZaloButtonUI() {
    const zaloBtn = document.querySelector('#resultMessageContainer .result-box-button');
    if (zaloBtn) {
        zaloBtn.addEventListener('click', function() {
            zaloBtn.textContent = 'ğŸ”„ Äang má»Ÿ Zalo...';
            zaloBtn.style.backgroundColor = 'var(--button-hover-bg)';
            zaloBtn.style.transform = 'translateY(1px)';
        });
    }
}
});
</script>
</body>
</html>